<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:tal="http://xml.zope.org/namespaces/tal"
	xmlns:metal="http://xml.zope.org/namespaces/metal"
	xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	i18n:domain="bika"
	tal:define="portal_url nocall:context/portal_url;
				portal portal_url/getPortalObject;">
	
	<head>
		<link rel="stylesheet" type="text/css" media="all" href=""
	    	tal:attributes="href string:$portal_url/reports.css" />
	</head>

	<body tal:define="
		report_data view/report_data;
        parameters python:report_data.has_key('parameters') and report_data['parameters'] or [];
        datalines python:report_data.has_key('datalines') and report_data['datalines'] or {};
        footlines python:report_data.has_key('footlines') and report_data['footlines'] or {};">
        <!--
        
        Report customization notes
        ==========================================================================
        Available attributes:
        	
       	parameters[]
       	
       	datalines {
       		<group>: { 
       			 <analysisuid>: {
       			 	Method,
       			 	CaseID,
       			 	PatientID,
       			 	PatientAge,
       			 	PatientGender,
       			 	Onset
       			 	Received,
       			 	Comments,
       			 	Result       			 
       			 }    			      			 	
   			}
   		}
   		
   		footlines {
   			<group>: {
   				NumAnalyses,
   				NumCases,
   				NumPatients,
   			}
   			Total: {
   				NumAnalyses,
   				NumCases,
   				NumPatients
   			}
   		}   		
     			
   		Where:
   		- dict key <group> is the period grouping name (year, monthyear, yearweek)
   		- dict key <analysisuid> is the uid of the a
   		- Method: Method/s used for the selected analysis
   		- PatientID: The ID for the Case's patient
   		- PatientAge: The Age (when case onset) of the patient
   		- PatientGender: The gender of the Case's patient
   		- Onset: Case's onset date
   		- Received: Date when samples where received
   		- AdditionalNotes: Case's additional notes
   		- Result: Analysis result
   		
   		
   		Default structure:
   		
   		Jan 2012 (grouping period - if grouping selected)   		
   		[CASEID]	[PatientID]	 	[Mehod]						[Result]	[Age]	[Gender]	[Onset]		[Received]		[Comments]
   		==============================================================================================================================
   		C0001		12345			Dengue Real Time RT-PCR		Positive	33		Male		2012-01-20	2012-01-21		asdkajdasd
   		------------------------------------------------------------------------------------------------------------------------------
   		Total Num of Cases:	1
   		Total Num of Patients: 1
        -->
        
		<h2 i18n:translate="">Cases per analysis</h2>
		<h3 i18n:translate="">Reports selected Analysis cases for any given period</h3>
			
		<!-- Summary -->
		<table class="bika-report-parms" summary="Parameters">
			<tr tal:repeat="line parameters">
				<td tal:content="python:line['title']"></td>
				<td tal:content="python:line['value']"></td>
			</tr>
		</table>
		
		<!-- Results -->		
		<metal:block tal:repeat="period python:datalines.keys()">
			<h4 tal:content="period" tal:condition="python:len(period)>0">
			</h4>		
			
			<table class="bika-report-table" summary="Cases">
				<thead>
					<tr>
						<th i18n:translate="">Case</th>
						<th i18n:translate="">Patient</th>					
						<th i18n:translate="">Method</th>
						<th i18n:translate="">Result</th>
						<th i18n:translate="">Age</th>
						<th i18n:translate="">Gender</th>
						<th i18n:translate="">Received</th>
						<th i18n:translate="">Comments</th>
					</tr>
				</thead>
				<tbody>					
					<metal:block tal:repeat="line python:datalines[period].values()">
					<tr>
						<td tal:content="python:line['CaseID']"></td>
						<td tal:content="python:line['PatientID']"></td>	
						<td tal:content="python:line['Method']"></td>
						<td tal:content="python:line['Result']"></td>
						<td tal:content="python:line['PatientAge']"></td>
						<td tal:content="python:line['PatientGender']"></td>
						<td tal:content="python:line['Received']"></td>
						<td tal:content="python:line['Comments']"></td>
					</tr>	
					</metal:block>
				</tbody>
				<tfoot tal:condition="python:len(period)>0">
					<tr>
						<td class='total_label' i18n:translate="" align="right" style="border-bottom:none;">Num of Analyses</td>
						<td tal:content="python:footlines[period]['NumAnalyses']" colspan="8" style="border-bottom:none;"></td>
					</tr>
					<tr>
						<td class='total_label' i18n:translate="" align="right" style="border-bottom:none;">Num of Patients</td>
						<td tal:content="python:datalines[period]['NumPatients']" colspan="8" style="border-bottom:none;"></td>
					</tr>
					<tr>
						<td class='total_label' i18n:translate="" align="right" style="border-bottom:none;">Num of Cases</td>
						<td tal:content="python:datalines[period]['NumCases']" colspan="8" style="border-bottom:none;"></td>
					</tr>
				</tfoot>			
			</table>
		</metal:block>
		<div style="margin-top:20px;border-tpop:1px solid #DCDCDC;">
			<span class='total_label' i18n:translate="">Total Num of Analyses</span>:&nbsp;&nbsp;
			<span class='total_label' tal:content="python:footlines['Total']['NumAnalyses']"></span>
			<br/>
			<span class='total_label' i18n:translate="">Total Num of Patients</span>:&nbsp;&nbsp;
			<span class='total_label' tal:content="python:footlines['Total']['NumPatients']"></span>
			<br/>
			<span class='total_label' i18n:translate="">Total Num of Cases</span>:&nbsp;&nbsp;
			<span class='total_label' tal:content="python:footlines['Total']['NumCases']"></span>
			<br/>
		</div>
	</body>
</html>