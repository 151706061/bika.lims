<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:tal="http://xml.zope.org/namespaces/tal"
	xmlns:metal="http://xml.zope.org/namespaces/metal"
	xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	i18n:domain="bika"
	tal:define="portal_url nocall:context/portal_url;
				portal portal_url/getPortalObject;">
	
	<head>
		<link rel="stylesheet" type="text/css" media="all" href=""
	    	tal:attributes="href string:$portal_url/reports.css" />
	</head>

	<body tal:define="
		report_data view/report_data;
        parameters python:report_data.has_key('parameters') and report_data['parameters'] or [];
        datalines python:report_data.has_key('datalines') and report_data['datalines'] or {};
        footlines python:report_data.has_key('footlines') and report_data['footlines'] or {};">
        
        <!--
        
        Report customization notes
        ==========================================================================
        Available attributes:
        	
       	parameters[]
       	
       	datalines {
       		<group>: { 
       			 Group, 
       			 Count, 
       			 Ratio,
       			 RatioPercentage, 
       			 Departments {
       			 		<dept>: {
       			 			Department
       			 			Count,
       			 			Ratio
       			 			RatioPercentage	
       			 		}
       			 }        			 	
   			}
   		}
     			
   		Where:
   		- dict key <group> is the group name (year, monthyear, yearweek)
   		- dict key <dept> is the dept name
   		
   		- Department: The name of the department
   		- Count: The number of items for that group/subgroup
   		- Ratio: Group items number/Subgroup items number
   		- RatioPercentage: Ratio * 100 with 2 decimals
       	
       	footlines {
       		'Total': total count
       	}
        
        -->
        
		<h2 i18n:translate="">Analyses per department</h2>
		<h3 i18n:translate=""></h3>
			
		<!-- Summary -->
		<table class="bika-report-parms" summary="Parameters">
			<tr tal:repeat="line parameters">
				<td tal:content="python:line['title']"></td>
				<td tal:content="python:line['value']"></td>
			</tr>
		</table>
				
		<!-- Results -->		
		<table class="bika-report-table" summary="Results">
			<thead>
				<tr>
					<th i18n:translate="">Period</th>					
					<th i18n:translate="">Department</th>
					<th i18n:translate="">Count</th>
					<th i18n:translate="">%</th>
				</tr>
			</thead>
			<tbody>
				<metal:block tal:repeat="key python:datalines.keys()">
				<tr>
					<td tal:content="key" colspan="4"></td>
				</tr>
				<metal:block tal:repeat="dept python:datalines[key]['Departments'].keys()">
				<tr>
					<td>&nbsp;</td>
					<td tal:content="dept"></td>
					<td tal:content="python:datalines[key]['Departments'][dept]['Count']"></td>					
					<td tal:content="python:datalines[key]['Departments'][dept]['RatioPercentage']"></td>
				</tr>
				</metal:block>
				<tr>
					<td class='total_label' i18n:translate="" colspan="2" align="right">Subtotal</td>
					<td tal:content="python:datalines[key]['Count']"></td>
					<td tal:content="python:datalines[key]['RatioPercentage']"></td>
				</tr>
				</metal:block>
			</tbody>	
			<tfoot>
				<tr>
					<td class='total_label' i18n:translate="" colspan="2" align="right">Total</td>
					<td tal:content="python:footlines['Total']['Count']"></td>
					<td>100%</td>
				</tr>
			</tfoot>		
		</table>
	</body>
</html>