<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:tal="http://xml.zope.org/namespaces/tal"
	xmlns:metal="http://xml.zope.org/namespaces/metal"
	xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	i18n:domain="bika"
	tal:define="portal_url nocall:context/portal_url;
				portal portal_url/getPortalObject;">
	
	<head>
		<link rel="stylesheet" type="text/css" media="all" href=""
	    	tal:attributes="href string:$portal_url/reports.css" />
	</head>

	<body tal:define="
		report_data view/report_data;
        parameters python:report_data.has_key('parameters') and report_data['parameters'] or [];
        datalines python:report_data.has_key('datalines') and report_data['datalines'] or {};
        footlines python:report_data.has_key('footlines') and report_data['footlines'] or [];">
        
        <!--
        
        Report customization notes
        ==========================================================================
        Available attributes:
        
        	parameters[]
        	
        	datalines {
        		<country>: {
        			CountryName,
        			SamplesCount,
        			AnalysesCount,
        			Samples: [{
        				'AnalysisKeyword',
       					'AnalysisTitle',
       					'SampleID',
       					'SampleType',
       					'SampleDateReceived',
       					'SampleSamplingDate'
        			}]
        		}
        	}
        	
        	Where
        	- dict key <country> is the name of the country
        	- CountryName is the name of the country
        	- Samples is an array of lines of sample-analysis
        	- AnalysisKeyword: The keyword of the analysis attached to a sample
        	- AnalysisTitle: The name of the analysis attached to a sample
        	- SampleID: Identifier of the sample
        	- SampleType: Title of the sample type attached to sample 
        	- SampleDateReceived: Date of sample reception in lab
        	- SampleSamplingDate
        	
        	footlines[0]
        		- TotalCount: Number of result lines
        
        -->
        
		<h2 i18n:translate="">Daily samples received</h2>
		<h3 i18n:translate="">Samples received for a date range and grouped by countries</h3>
			
		<!-- Summary -->
		<table class="bika-report-parms" summary="Parameters">
			<tr tal:repeat="line parameters">
				<td tal:content="python:line['title']"></td>
				<td tal:content="python:line['value']"></td>
			</tr>
		</table>
				
		<!-- Results -->		
		<table class="bika-report-table" summary="Results">
			<thead>
				<tr>
					<th i18n:translate="">Country</th>
					<th i18n:translate="">Analysis</th>
					<th i18n:translate="">Sample ID</th>
					<th i18n:translate="">Sample Type</th>
					<th i18n:translate="">Date received</th>
				</tr>
			</thead>
			<tbody>				
				<metal:block tal:repeat="country python:datalines.keys()">
					<tr style="background-color:#efefef;">
						<td  class='total_label' tal:content="country" colspan="5"></td>
					</tr>	
					<metal:block tal:repeat="sample python:datalines[country]['Samples']">
						<tr>
							<td>&nbsp;</td>
							<td tal:content="python:sample['AnalysisTitle']"></td>
							<td tal:content="python:sample['SampleID']"></td>					
							<td tal:content="python:sample['SampleType']"></td>
							<td tal:content="python:sample['SampleDateReceived']"></td>
						</tr>
					</metal:block>				
					<tr>
						<td class='total_label' i18n:translate="" align="right">Subtotal</td>
						<td tal:content="python:datalines[country]['AnalysesCount']"></td>
						<td tal:content="python:datalines[country]['SamplesCount']" colspan="3"></td>
					</tr>			
				</metal:block>
			</tbody>	
			<tfoot>
				<metal:block tal:repeat="line footlines">
				<tr>
					<td i18n:translate="" class='total_label'>Total:</td>
					<td tal:content="python:line['AnalysesCount']"></td>
					<td tal:content="python:line['SamplesCount']" colspan="3"></td>
				</tr>
				</metal:block>
			</tfoot>		
		</table>
	</body>
</html>