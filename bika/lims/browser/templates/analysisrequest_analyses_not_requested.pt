<html xmlns="http://www.w3.org/1999/xhtml"
	xml:lang="en" lang="en"
	xmlns:tal="http://xml.zope.org/namespaces/tal"
	xmlns:metal="http://xml.zope.org/namespaces/metal"
	xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	metal:use-macro="here/main_template/macros/master"
	i18n:domain="bika">

<body>

<metal:title fill-slot="content-title">
	<h1>
        <img tal:condition="view/icon | nothing"
            src="" tal:attributes="src view/icon"/>
		<span tal:content="here/title_or_id"/>
		<img
			tal:condition="here/getInvoiceExclude"
			tal:attributes="src string:++resource++bika.lims.images/no_invoice.png">
	</h1>
</metal:title>

<metal:description fill-slot="content-description">
</metal:description>

<metal:content fill-slot="content-core"
	tal:define="
		portal context/@@plone_portal_state/portal;
		tabindex view/tabindex;
		specification python:request.get('specification', 'lab')">
	<form name="folderContentsForm"
		method="post"
		tal:define="
			b_size python:100;
			b_start python:0;
			b_start request/b_start | b_start;
			Batch python:modules['Products.CMFPlone'].Batch;
			batch python:Batch(view.get_analyses_not_requested(), b_size, int(b_start), orphan=1);
			client_uid here/aq_parent/UID;
			sample python:here.getSample();
			sampletype python:sample.getSampleType()">

		<table width="100%">
			<tr>
				<td>
					<form name="specificationForm"
						enctype="multipart/form-data"
						method="post">
					<span i18n:translate="label_range_specification">Range Specification</span>
					<input class="noborder"
						type="radio"
						name="specification"
						value="lab"
						tal:attributes="
							checked python:specification == 'lab' and 'checked' or None;
							tabindex tabindex/next"/>
					<label i18n:translate="label_lab">Lab</label>
					<input class="noborder"
						type="radio"
						name="specification"
						value="client"
						tal:attributes="
							checked python:specification == 'client' and 'checked' or None;
							tabindex tabindex/next"/>
					<label i18n:translate="label_client">Client</label>
					</form>
				</td>
				<td align="right">
					<img tal:condition="view/getHazardous"
						src=""
                        title="Hazardous"
                        tal:attributes="src string:++resource.bika.lims.images/hazardous_big.png">
				</td>
			</tr>
		</table>

		<p tal:condition="not: batch" i18n:translate="analysisrequest_no_analyses_not_requested">
			There are no results.
		</p>

		<table
			summary="Analyses not requested"
			class="listing"
			cellpadding="0" cellspacing="0">

		<thead>

			<tr tal:condition="batch|nothing">
				<th class="nosort">
					<input
						type="checkbox"
						name="selectButton"
						title="Select all items"
						onClick="toggleSelect(this);"
						i18n:attributes="title"/>
				</th>
				<th i18n:translate="label_analysis">Analysis</th>
				<th i18n:translate="label_unit">Unit</th>
				<th i18n:translate="label_result">Result</th>
				<th i18n:translate="label_status">Status</th>
			</tr>

		</thead>

		<tbody tal:condition="batch|nothing">
			<tal:item tal:repeat="item batch">
			<tr tal:define="
					oddrow repeat/item/odd;
					item_title_or_id item/title_or_id;
					wtool python:context.portal_workflow;
					review_state python:wtool.getInfoFor(item, 'review_state', '')"
				tal:attributes="
					class python:oddrow and 'even' or 'odd'" >

				<td>
					<input type="checkbox" class="noborder" name="ids:list" id="#" value="#"
						tal:attributes="
							value item/getId;
							id python: 'cb_'+item.getId();
							tabindex tabindex/next|nothing;
							alt string:Select $item_title_or_id;
							title string:Select $item_title_or_id"/>
				</td>
				<td tal:content="item/Title"/>
				<td tal:content="item/getUnit"/>
				<td tal:condition="python:review_state == 'sample_received'">
					<input size="10" name="" value="10"
						tal:attributes="
							value item/getResult;
							name string:results.${item/getId}:record;
							tabindex tabindex/next"/>
				</td>

				<tal:result
					tal:condition="python:review_state != 'sample_received'"
					tal:define="result_class python:view.XXXresult_in_range(item, sampletype.UID(), specification)">
					<td tal:attributes="class result_class" tal:content="item/getResult"/>
				</tal:result>

				<td class="private"
					tal:content="structure python:review_state and review_state or ''"
					tal:attributes="
						class python:review_state and 'state-'+review_state or 'state-private'"/>
			</tr>
			</tal:item>
		</tbody>
		</table>

		<div metal:use-macro="here/batch_macros/macros/navigation" />

		<tal:buttons tal:repeat="button actions/folder_buttons|nothing">
		<input
			class="context"
			type="submit"
			name=""
			value=""
			tabindex=""
			tal:condition="python:batch and button['id'] in ('delete', 'change_state', 'submit_results')"
			i18n:attributes="value"
			tal:attributes="
				value button/name;
				name button/url;
				tabindex tabindex/next" />
		</tal:buttons>


		<tal:ar_actions
			condition="batch"
			define="ar_workflow_actions python: view.get_analysis_request_actions()">

		<input type="hidden" id="workflow_action" name="workflow_action" value=""/>

		<tal:buttons tal:repeat="transition ar_workflow_actions">

		<input
			class="context"
			type="submit"
			name="folder_publish:method"
			value=""
			tabindex=""
			tal:condition="python:transition['id'] != 'assign'"
			i18n:attributes="value"
			tal:attributes="
				value transition/title;
				tabindex tabindex/next;
				onclick string:this.form.workflow_action.value = '${transition/id}'" />
		</tal:buttons>
		</tal:ar_actions>

		<img tal:condition="sampletype/getHazardous"
			tal:attributes="src string:++resource++bika.lims.images/hazardous_big.png">

	</form>

</metal:content>
</body>
</html>
