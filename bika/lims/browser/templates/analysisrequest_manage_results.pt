<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="here/main_template/macros/master"
  i18n:domain="bika">

<body tal:define="
  portal context/@@plone_portal_state/portal;
  specification python:request.get('specification', 'lab');
  global out_of_range python:0;
  global late python:0;
  tabindex view/tabindex;
  now view/now">

  <metal:content-title fill-slot="content-title">
    <h1 class="documentFirstHeading" tal:content="context/title_or_id"/>
    <img src=""
      tal:condition="here/getInvoiceExclude"
      tal:attributes="src string:${portal/absolute_url}/images/no_invoice.png"/>
  </metal:content-title>

  <metal:content-description fill-slot="content-description">
  </metal:content-description>

  <metal:content-core fill-slot="content-core"
    tal:define="
      tabindex view/tabindex;
      portal context/@@plone_portal_state/portal;
      specification python: request.get('specification', view.getDefaultSpec());
      ar_attach_allowed here/bika_settings/getARAttachmentsPermitted;
      ar_review_state python: context.portal_workflow.getInfoFor(context, 'review_state');
      analysis_attach_allowed here/bika_settings/getAnalysisAttachmentsPermitted;
      attachments_allowed here/bika_settings/getAttachmentsPermitted;
      attachments here/getAttachment | nothing;
      delete_attachments python:True;
      update_attachments python:True">

    <div tal:condition="attachments_allowed">
      <metal:block use-macro="here/attachments/macros/attachments"/>
    </div>

    <table width="100%">
      <tr>
        <td>
          <form name="specificationForm"
            enctype="multipart/form-data"
            method="post">
            <span i18n:translate="label_range_specification">Range Specification</span>:
            <input class="noborder" type="radio" name="specification" value="lab"
            onclick="this.form.submit()"
            tal:attributes="
              checked python:specification == 'lab' and 'checked' or None;
              tabindex tabindex/next"/>
            <label i18n:translate="label_lab">Lab</label>
            <input class="noborder" type="radio" name="specification" value="client"
            onclick="this.form.submit()"
            tal:attributes="
              checked python:specification == 'client' and 'checked' or None;
              tabindex tabindex/next"/>
            <label i18n:translate="label_client">Client</label>
          </form>
        </td>
        <td align="right">
          <img tal:condition="view/getHazardous"
               src="" tal:attributes="src string:${portal/absolute_url}/images/hazardous.png">
        </td>
      </tr>
    </table>

    <form id="analysisrequest_manage_results_form"
          name="analysisrequest_manage_results_form"
          method="post">

      <input type="hidden" name="submitted" value="1" />

      <tal:field_analyses>
        <h3 tal:content="python: modules['bika.lims.config'].POINTS_OF_CAPTURE.getValue('field')"/>
        <span tal:replace="structure python: view.FieldAnalysesView.contents_table()"/>
      </tal:field_analyses>

      <tal:lab_analyses>
        <h3 tal:content="python: modules['bika.lims.config'].POINTS_OF_CAPTURE.getValue('lab')"/>
        <span tal:replace="structure python: view.LabAnalysesView.contents_table()"/>
      </tal:lab_analyses>
    </form>

  </metal:content-core>

</body>
</html>



<!--

<table
  class="analysisrequest"
  summary="Content listing"
  cellpadding="0" cellspacing="0"
  tal:define="
      colspan python:6;
    colspan python:any_tv and (colspan + 1) or colspan;
    colspan python:any_tf and (colspan + 1) or colspan;
    colspan python:any_vm and (colspan + 1) or colspan;
    colspan python:any_gm and (colspan + 1) or colspan;
    colspan python:any_sm and (colspan + 1) or colspan;
    colspan python:any_nm and (colspan + 1) or colspan;
    colspan python:analysis_attach_allowed and (colspan + 1) or colspan">

<thead>

<metal:block tal:condition="batch|nothing">
<tr>
<th class="nosort">
<input
  class="noborder"
  type="checkbox"
  src="select_all_icon.gif"
  name="selectButton"
  title="Select all items"
  onClick="toggleSelect(this);"
  tal:attributes="src string:$portal_url/select_all_icon.gif"
  alt="Select all items"
  i18n:attributes="title; alt"
  />
</th>
<th i18n:translate="label_analysis">Analysis</th>
<tal:tv condition="python:any_tv">
<th i18n:translate="label_titrationvolume">Titration Volume</th>
</tal:tv>
<tal:tf condition="python:any_tf">
<th i18n:translate="label_titrationfactor">Titration Factor</th>
</tal:tf>
<tal:vm condition="python:any_vm">
<th i18n:translate="label_vesselmass">Vessel Mass</th>
</tal:vm>
<tal:gm condition="python:any_gm">
<th i18n:translate="label_grossweight">Gross Mass</th>
</tal:gm>
<tal:sm condition="python:any_sm">
<th i18n:translate="label_samplemass">Sample Mass</th>
</tal:sm>
<tal:nm condition="python:any_nm">
<th i18n:translate="label_netweight">Net Mass</th>
</tal:nm>
<th>
<span i18n:translate="label_result">Result</span>
<div tal:condition="here/getReportDryMatter"
  i18n:translate="label_as_DM">(as DM)</div>
</th>
<th i18n:translate="label_retested">Retested</th>
<th i18n:translate="label_variation">+/-</th>
<th i18n:translate="label_status">Status</th>
<th tal:condition="analysis_attach_allowed"
  i18n:translate="label_attachments">Attachments</th>
</tr>
</metal:block>

</thead>

<metal:block tal:condition="batch|nothing"
  tal:define="global category python:None">
<tbody>
<metal:block tal:repeat="item batch">
<tal:analyses
  tal:define="service item/getService">
<tr tal:condition="python:service.getCategoryName() != category">
<td class="category" tal:attributes="colspan colspan"
  tal:define="global category service/getCategoryName"
  tal:content="category"></td>
</tr>
<tr tal:define="
    oddrow repeat/item/odd;
    item_title_or_id item/title_or_id;
    result item/getResult;
    optionstrings python: service.getResultOptionsSorted();
    item_cols python:view.get_calc_columns([item,]);
    wtool python:context.portal_workflow;
    review_state python:wtool.getInfoFor(item, 'review_state', '');
    analysis_late python:review_state not in ['sample_due', 'published'] and item.getDueDate() < now"
  tal:attributes="class python:oddrow and 'even' or 'odd'" >

<td>

<input type="checkbox" class="noborder" name="ids:list" id="#" value="#"
  tal:attributes="
    value item/getId;
    id python: 'cb_'+item.getId();
    tabindex tabindex/next|nothing;
    alt string:Select $item_title_or_id;
    title string:Select $item_title_or_id"/>
</td>

<td class="left">
<a  onClick="" title="Click for details"
  tal:attributes="onClick string:javascript:showMethod('$portal_url', '${item/getId}')"
  tal:content="item/Title">
Alcohol
</a>
<img tal:condition="python:here.getReportDryMatter() and service.getReportDryMatter()"
  src="" tal:attributes="src string:${portal/absolute_url}/images/dry.png">
<tal:late tal:condition="analysis_late">
<img tal:define="global late python:1"
  src="" tal:attributes="src string:${portal/absolute_url}/images/late_small.png">
</tal:late>
<input type="hidden" name=""
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getCalcType;
    id string:${item/getId}.CalcType"/>
</td>

<tal:tv
   condition="python:any_tv">
<td>

<div tal:condition="python:'tv' in item_cols">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getTitrationVolume;
    name string:results.${item/getId}.TitrationVolume:record;
    onChange string:calcResult('${item/getId}');
    tabindex tabindex/next"/>
<span
  tal:define="titration_vol item/getTitrationVolume|nothing;
        titration_unit service/getTitrationUnit"
  tal:condition="python:review_state not in ('sample_received', 'assigned') and titration_vol"
  tal:content="string:$titration_vol $titration_unit">10ml</span>
</div>
</td>
</tal:tv>

<tal:tf
   condition="python:any_tf">
<td>
<div tal:condition="python:'tf' in item_cols">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getTitrationFactor;
    name string:results.${item/getId}.TitrationFactor:record;
    onChange string:calcResult('${item/getId}');
    tabindex tabindex/next"/>
<span
  tal:condition="python:review_state not in ('sample_received', 'assigned')"
  tal:content="item/getTitrationFactor">10</span>
</div>
</td>
</tal:tf>

<tal:vm
   condition="python:any_vm">
<td>
<div tal:condition="python:'vm' in item_cols">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getVesselMass;
    name string:results.${item/getId}.VesselMass:record;
    onChange string:calcResult('${item/getId}');
    tabindex tabindex/next"/>
<span
  tal:condition="python:review_state not in ('sample_received', 'assigned')"
  tal:content="item/getVesselMass">10</span>
</div>
</td>
</tal:vm>
<tal:gm
   condition="python:any_gm">
<td>

<div tal:condition="python:'gm' in item_cols">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getGrossMass;
    name string:results.${item/getId}.GrossMass:record;
    onChange string:calcResult('${item/getId}');
    tabindex tabindex/next"/>
<span
  tal:condition="python:review_state not in ('sample_received', 'assigned')"
  tal:content="item/getGrossMass|nothing">10ml</span>
</div>
</td>
</tal:gm>

<tal:sm
   condition="python:any_sm">
<td>
<div tal:condition="python:'sm' in item_cols">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getSampleMass;
    name string:results.${item/getId}.SampleMass:record;
    onChange string:calcResult('${item/getId}');
    tabindex tabindex/next"/>
<span
  tal:condition="python:review_state not in ('sample_received', 'assigned')"
  tal:content="item/getSampleMass">10</span>
</div>
</td>
</tal:sm>

<tal:nm
   condition="python:any_nm">
<td>
<div tal:condition="python:'nm' in item_cols">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value item/getNetMass;
    name string:results.${item/getId}.NetMass:record;
    onChange string:calcResult('${item/getId}');
    tabindex tabindex/next"/>
<span
  tal:condition="python:review_state not in ('sample_received', 'assigned')"
  tal:content="item/getNetMass">10</span>
</div>
</td>
</tal:nm>

<tal:result
  tal:define="calc_reqd python:item.getCalcType() is not None">

<div tal:condition="python:review_state in ('sample_received', 'assigned')">
<td tal:condition="calc_reqd" class="left" style="white-space: nowrap;">
<input READONLY class="calculated" size="6" name="" value="10" tabindex="-1"
  tal:condition="python:review_state in ('sample_received', 'assigned')"
  tal:attributes="
    value result;
    name string:results.${item/getId}.Result:record"/>
<span class="unit" tal:content="item/getUnit">ml</span>

</td>

<td tal:condition="python:not calc_reqd" class="left" style="white-space: nowrap;">
<input size="6" name="" value="10"
  tal:condition="python:review_state in ('sample_received', 'assigned') and not optionstrings"
  tal:attributes="
    value result;
    name string:results.${item/getId}.Result:record;
    tabindex tabindex/next"/>
<select tal:condition="python:review_state in ('sample_received', 'assigned') and optionstrings"
tal:attributes="
  name string:results.${item/getId}.Result:record;
  tabindex tabindex/next">
  <option value=""></option>
  <tal:opts repeat="option optionstrings">
    <option tal:content="option"
        tal:attributes="value option;
                selected python:result == option and 'selected' or ''"
        >Title</option>
  </tal:opts>
</select>
<span class="unit" tal:content="item/getUnit">ml</span>
</td>
</div>

<div tal:condition="python:review_state not in ('sample_received', 'assigned')">
<tal:resultentered
  tal:define="
    result_class python:view.result_in_range(item, sampletype.UID(), specification);
    global out_of_range python:result_class == 'out_of_range' and 1 or out_of_range">
<td tal:attributes="class result_class"  style="white-space: nowrap;">
<span tal:content="result">10.00</span>
<tal:dry tal:condition="item/getResultDM">
<span tal:define="dry_result string:(${item/getResultDM})"
  tal:content="dry_result">10</span>
</tal:dry>
<span class="unit" tal:content="item/getUnit">ml</span>
<img tal:condition="python:result_class == 'out_of_range'"
  src="" tal:attributes="src string:${portal/absolute_url}/images/exclamation.png">
</td>
</tal:resultentered>
</div>
</tal:result>

<td align="center">
<div
  tal:define="item_id item/getId"
  tal:condition="python:review_state in ('sample_received', 'assigned')">
<input class="noborder" type="checkbox" name="Retested_visible"
     value="on" id="Retested"
     onclick=""
     tal:define="input_id string:${item_id}.Retested"
     tal:attributes="
      id input_id;
      checked item/getRetested;
      onclick string:javascript:toggleBoolean('${item_id}.Retested', '${item_id}.Retested_hidden')"/>
<input type="hidden" name=""
     value="" id=""
     tal:define="
      input_name string:results.${item_id}.Retested;
      input_id string:${item_id}.Retested_hidden"
     tal:attributes="
      id input_id;
      name string:${input_name}:record;
      value item/getRetested"/>
</div>
<div tal:condition="python:review_state not in ('sample_received', 'assigned')">
<span class="retested"
    tal:condition="item/getRetested"
    i18n:translate="retested">retested</span>
</div>
</td>

<tal:uncertainties
  condition="result">
<td tal:content="item/getUncertainty">0.1</td>
</tal:uncertainties>
<tal:no_uncertainties
  condition="python:not result">
<td></td>
</tal:no_uncertainties>
<td class="private"
  tal:content="structure python:review_state and review_state or '&nbsp;'"
  tal:attributes="
    class python:review_state and 'state-'+review_state or 'state-private'"
  i18n:translate="">&nbsp;
</td>
<td tal:condition="analysis_attach_allowed">
<div tal:condition="python:not service.getAttachmentOption() == 'n'">
<tal:attachments
  tal:define="attachments item/getAttachment | nothing;
        delete_attachments python:True">
<div tal:condition="attachments_allowed">
<metal:block use-macro="here/attachments/macros/analysis_attachments_list"/>
</div>
</tal:attachments>
</div>
</td>
</tr>
</tal:analyses>

</metal:block>
</tbody>
</metal:block>

</table>

<tal:buttons repeat="button python:context.portal_actions.listFilteredActionsFor(context)['folder_buttons'] or None">
<input
  class="context"
  type="submit"
  name="button/id"
  value=""
  tabindex=""
  tal:condition="python:batch and button['id'] in ('submit_results')"
  i18n:attributes="value"
  tal:attributes="
    name button/id;
    value button/title;
    tabindex tabindex/next" />
</tal:buttons>

<tal:ar_actions
  condition="batch"
  define="ar_workflow_actions python: view.get_analysis_request_actions()">

  <input type="hidden" id="workflow_action" name="workflow_action" value=""/>
  <input type="hidden" id="AnalysisAttachment" name="AnalysisAttachment" value=""/>

  <tal:buttons tal:repeat="transition ar_workflow_actions">
    <input
      class="context"
      type="submit"
      name=""
      value=""
      tabindex=""
      tal:condition="python:transition['id'] not in  ['assign', 'republish', 'prepublish']"
      i18n:attributes="value"
      tal:attributes="
        name transition/id;
        value transition/title;
        tabindex tabindex/next;
        onclick string:this.form.workflow_action.value = '${transition/id}'" />
  </tal:buttons>
</tal:ar_actions>


<div metal:use-macro="here/batch_macros/macros/navigation" />

<br/>
<br/>
<div class="discreeter">
<p tal:condition="out_of_range">
<img src="" tal:attributes="src string:${portal/absolute_url}/images/exclamation.png">
<span i18n:translate="legend_out_of_rangex">
Result out of <tal:block replace="specification" i18n:name="spec"/> specified range
</span>
</p>
<p tal:condition="late">
<img src="" tal:attributes="src string:${portal/absolute_url}/images/late_small.png">
<span i18n:translate="legend_late">Late analysis</span>
</p>
<p tal:condition="here/getReportDryMatter">
<img src="" tal:attributes="src string:${portal/absolute_url}/images/dry.png">
<span i18n:translate="disclaimer_dry">
Reported as dry matter. Values in brackets denote results on a 'Dry Matter' basis</span>
</p>
</div>
</form>

</div>
-->
