<html xmlns="http://www.w3.org/1999/xhtml" 
    tal:define="portal_state context/@@plone_portal_state;
        context_state context/@@plone_context_state;
        plone_view context/@@plone;
        lang portal_state/language;
        view nocall:view | nocall: plone_view;
        dummy python: plone_view.mark_view(view);
        portal_url portal_state/portal_url;
        checkPermission nocall: context/portal_membership/checkPermission;
        site_properties context/portal_properties/site_properties;
        ajax_load request/ajax_load | nothing;
        ajax_include_head request/ajax_include_head | nothing"
    tal:attributes="lang lang;">

<head>
  <div tal:replace="structure provider:plone.htmlhead" />
</head>

<body onload="focus();self.name='referencebrowser_popup'" style="margin: 4px;padding:0.5em;" 
      tal:define="border_color here/base_properties/globalBorderColor;
                  show_indexes string:1;
                  client python:context.aq_parent;
                  b_size python:15;
                  b_start python:0;
                  b_start request/b_start | b_start;
                  Batch python:modules['Products.CMFPlone'].Batch;">

  <div style="text-align:right;">
     <a href="javascript:window.close()" i18n:translate="referencebrowser_close">close window</a>
  </div>

  <h2>Select an existing sample</h2>

  <!-- actual list of objects -->
  <tal:block 
    tal:define="
      all_results python:view.Samples(client);
      all_uids python:[sample.UID for sample in all_results];
      batch python: Batch(all_results, b_size, int(b_start), orphan=1)">
  
    <div style="border-top:1px solid black;border-bottom:1px solid black;"
            tal:attributes="style string:border-top:1px solid ${border_color};;
                                  border-bottom:1px solid ${border_color};;
                                  margin-bottom:1em;;padding:0.2em 0 0.1em 0">
        <strong tal:content="here/title_or_id"/>
    </div>

    <!-- object list -->
    <tal:noresults tal:condition="python:not all_results">
      <p i18n:translate="referencebrowser_no_items_found">No items found.</p>
    </tal:noresults>

    <tal:list>
      <table width="100%" cellspacing="0" cellpadding="0" class="analysisrequest" tal:condition="batch">
        <tbody>
          <tr>
            <th>Sample ID</th>
            <th>Requests</th>
            <th>&nbsp;</th>
          </tr>
          <tal:results tal:repeat="item batch">
            <tal:row >
              <tr tal:define="oddrow repeat/item/odd"
                  tal:attributes="class python: oddrow and 'even' or 'odd'">
                <td id="sample_browser_submit" 
                    tal:content="item/Title"
                    tal:define="sample item/getObject;"
                    tal:attributes="
                        column python:request.get('column');
                        SampleID item/Title;
                        ClientReference item/getClientReference;
                        ClientSampleID item/getClientSampleID;
                        DateSampled sample/getDateSampled;
                        SampleType python:sample.getSampleType() and sample.getSampleType().Title() or '';
                        SamplePoint python:sample.getSamplePoint() and sample.getSamplePoint().Title() or '';
                        field_analyses python:view.FieldAnalyses(sample);
                        "/>
                <td tal:content="python:','.join([t.Title() for t in item.getObject().getAnalysisRequests()])"/>
                <td width="25%">
                  <a href="" target="_blank"
                      tal:attributes="href python:item.absolute_url()+'/edit';">
                    <strong i18n:translate="referencebrowser_view">view</strong>
                  </a>
                </td>
              </tr>
            </tal:row>
          </tal:results>
        </tbody>
      </table>
    <div metal:use-macro="here/batch_macros/macros/navigation" />
    </tal:list>
  </tal:block>
</body>

</html>
