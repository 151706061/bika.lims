<!-- Inserted into each category; a list of Services, one per TR, with checkboxes in TDs.  -->
<tal:define define="categoryUID python:view.request['categoryUID'];
                   poc python:view.request['poc'];">
  <tr tal:repeat="service python:view.Services(categoryUID, poc)"
      tal:define="portal context/@@plone_portal_state/portal">
    <th>
      <span tal:content="service/Title"/>
      <em style="white-space:nowrap;" tal:condition="service/getUnit">(<span tal:replace="service/getUnit">mg/l</span>)</em>
      <img tal:condition="python:context.bika_settings.laboratory.getLaboratoryAccredited() and service.getAccredited"
           tal:attributes="src string:${portal/absolute_url}/images/accredited.png"/>
    </th>
    <td>
      <input class="price" type="text" size="5" 
        tal:attributes="value service/getPrice;
                        id string:ar_${categoryUID}_${poc}_${service/UID}_price;
                        name string:Prices.${service/UID}:record"/>
    </td>
    <td>
      <image class="copyButton" 
        tal:attributes="id string:ar_${categoryUID}_${poc}_${service/UID};
                        src string:${portal/absolute_url}/images/copy.png"/>
    </td>
  
    <tal:block repeat="column python:range(int(view.request['col_count']))">
      <td class="cb" 
          tal:define="
            input_id string:ar_${column}_${categoryUID}_${poc}_${service/UID};
            input_name string:ar.${column}.Analyses:list:ignore_empty:record;
            selected python:view.request['column'] != '' and column == int(view.request['column']) and view.request['selectedservices'] or '';
            serviceUID service/UID;">
        <input
         class="cb"
         type="checkbox"
         tal:attributes="id input_id;
                         name input_name;
                         value serviceUID;
                         checked python:(selected.find(serviceUID)>-1 or request.get(input_name, [])) and 'checked' or None;"/>
      </td>
    </tal:block>
  </tr>
</tal:define>
