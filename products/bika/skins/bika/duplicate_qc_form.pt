<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bika">

<head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border', 1)" />

    <metal:calendar fill-slot="javascript_head_slot">
        <!-- ECMAScript calendar -->
        <style type="text/css" media="all"
            tal:content="string:@import url($portal_url/jscalendar/calendar-system.css);"></style>
        <script type="text/javascript"
            tal:attributes="src string:$portal_url/jscalendar/calendar_stripped.js"></script>
        <script type="text/javascript" charset="iso-8859-1"
            tal:condition="exists: portal/jscalendar/calendar-en.js"
            tal:attributes="src string:$portal_url/jscalendar/calendar-en.js"></script>
    </metal:calendar>

</head>
             
             
<body>

<div metal:fill-slot="main"
    tal:define="
        client_uid python:request.get('ClientUID', None);
        cat_uid python:request.get('CategoryUID', None);
">

<h1>
<img src="analysisrequest.png" tal:attributes="src python:here.portal_types.getTypeInfo('AnalysisRequest').getIcon()"/>
<span i18n:translate="heading_duplicate_analysis_qc"
    >Duplicate Analysis QC</span>
</h1>

<fieldset>

<legend i18n:translate="legend_specify">Specify</legend>
<form action="" method="post" name="search"
    tal:attributes="action template/getId">

<div class="field">
    <label i18n:translate="label_client"
        >Client</label><br/>
    <select name="ClientUID" 
            style=""
            id="ClientUID"
            onChange="string:document.getElementById('getClientUID').value=document.getElementById('ClientUID').value"
            tal:attributes="
                style string:font-family:${here/base_properties/fontFamily};;font-size:100%;
                ">
        <option value="">All</option>

        <tal:clients
            define="    
                clients python:here.portal_catalog(portal_type='Client');
                sort_on python:(('Title', 'nocase', 'asc'),);
                clients python:sequence.sort(clients, sort_on);"
            repeat="client clients">
        <option value=""
            tal:define="this_uid python:client.UID"
            tal:attributes="value this_uid;
                selected python:client_uid == this_uid and 'selected' or ''"
            tal:content="client/Title"
            >Acme Systems</option>

        </tal:clients>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_category"
        >Category</label><br/>
    <select name="CategoryUID" 
            onChange="string:document.getElementById('getServiceUID').value = '';this.form.submit()"
            style=""
            id="CategoryUID"
            tal:attributes="
                style string:font-family:${here/base_properties/fontFamily};;font-size:100%;
                ">

        <tal:categories 
            tal:define="
        categories python:here.portal_catalog(portal_type='AnalysisCategory', sort_on='sortable_title');
        global first_cat python:categories[0].UID"
            tal:repeat="category categories">
        <option value=""
            tal:define="this_uid python:category.UID"
            tal:attributes="value this_uid;
                selected python:cat_uid == this_uid and 'selected' or ''"
            tal:content="category/Title"
            >Acme Systems</option>

        </tal:categories>
    </select>
</div>

</form>

<form action="duplicate_qc_results" method="post" name="search">
<div class="field">
    <label i18n:translate="label_analysisservice"
        >Analysis</label><br/>
    <select name="getServiceUID" 
            style="" id="getServiceUID">
        <tal:analyses
            define="    
                search_cat python:cat_uid and cat_uid or first_cat; 
                services python:here.portal_catalog(portal_type='AnalysisService', getCategoryUID=search_cat);
                sort_on python:(('Title', 'nocase', 'asc'),);
                services python:sequence.sort(services, sort_on);"
            tal:repeat="service services">
        <option value=""
            tal:define="this_uid python:service.UID"
            tal:attributes="value this_uid"
            tal:content="service/Title"
            >Alcohol</option>
        </tal:analyses>
    </select>
</div>

<tal:dates
    tal:define="
        now python:DateTime();
        past python:now - 60">
<div class="field">
    <label i18n:translate="label_dateverified"
        >Date verified</label><br/>
    <span i18n:translate="label_from">From</span>

    <tal:define define="
        id string:getDateVerified_fromdate;
        inputname id;
        formname string:search;
        value past;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/calendar_macros/macros/calendarDatePickerBox">
        a calendar, hopefully
    </metal:use>
    </tal:define>

    <span i18n:translate="label_to">to</span>

    <tal:define define="
        id string:getDateVerified_todate;
        inputname id;
        formname string:search;
        value now;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/calendar_macros/macros/calendarDatePickerBox">
        a calendar, hopefully
    </metal:use>
    </tal:define>

</div>

</tal:dates>
<input type="HIDDEN" name="portal_type"
    value="DuplicateAnalysis"/>
<input type="HIDDEN" name="getClientUID" id="getClientUID" value=""
    tal:attributes="value client_uid"/>
<input tabindex=""
    class="searchButton"
    type="submit"
    name="submit"
    value="Stats"
    i18n:attributes="value"
    />                       

</form>
</fieldset>

</div>

</body>
</html>

