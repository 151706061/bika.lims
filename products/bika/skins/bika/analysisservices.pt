<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="bika">

<head>

<metal:block fill-slot="top_slot">
<span
    tal:replace="nothing"
    tal:define="dummy python:request.set('enable_border', 1)"
    />
</metal:block>

</head>
             
             
<body>

<div metal:fill-slot="prefs_configlet_main">

<h1 tal:content="here/title">Tool title</h1>
<a href=""
    class="link-parent"
    tal:attributes="href string: $portal_url/plone_control_panel"
    i18n:translate="label_up_to_plone_setup">
Up to Plone Setup
</a>
<p tal:content="here/description">Tool description</p>
<tal:set tal:define="cat python:request.get('Category', None)">
<tal:x define="
    dummy_a python:request.set('portal_type', 'AnalysisService');
    dummy_c python:request.set('sort_on', 'sortable_title');
    "
    />
<tal:y tal:condition="python:cat != 'All'">
<tal:z tal:define="dummy_b python:request.set('getCategoryUID', cat)"/>
</tal:y>
</tal:set>


<div id="content-analysisservices"
     tal:define="
        results python:container.queryCatalog();
        Batch python:modules['Products.CMFPlone'].Batch;
        b_start python:request.get('b_start',0);
        batch python:Batch(results, 100, int(b_start), orphan=1);
        buttons actions/folder_buttons;
        global ar_action python:False;">

<form action="" name="tool_content_add" method="post"
      tal:attributes="action string: $portal_url/bika_services">

<input type="hidden" name="type_name"
       value="AnalysisService" />

<input class="standalone add" tabindex="0" type="submit"
       name="folder_factories:method"
       value="Add New Analysis Service" />

</form>

<br/>

<form name="filter_result" action="" method="post"
    tal:attributes="action template/getId"
    tal:define="categories python:[c for c in here.portal_catalog(portal_type='AnalysisCategory', sort_on='sortable_title')]">
<label i18n:translate="label_category">Category</label>
    <select name="Category"
        onchange="this.form.submit()"
        tal:attributes="tabindex tabindex/next;">

    <option selected="selected"
        tal:attributes="value python:None"
        >All</option>
    <tal:item 
        tal:define="
            vocab categories"
        tal:repeat="item vocab">
    <option selected="selected"
        tal:define="
            uid python:request.get('Category', );
            this_selected python:test((item.UID == uid), 'selected', '')"
        tal:attributes="value item/UID;
                        selected this_selected"
        tal:content="item/Title"></option>
    </tal:item>

    </select>
</form>


<tal:button_conditions
    tal:condition="python:batch"
    tal:repeat="button actions/folder_buttons|nothing">
<tal:check_for_action
    tal:condition="python:button['id'] == 'delete'">
<tal:action_found
    tal:define="global ar_action python:True">
</tal:action_found>
</tal:check_for_action>
</tal:button_conditions>


<form name="analysisservices"
    method="post"
    action="."
    tal:attributes="action here_url">
<table tal:condition="batch"
    class="listing"
    summary="analysis service listing"
    cellpadding="0" cellspacing="0">

<thead>
<tr>
<th class="nosort" tal:condition="ar_action"><input
    class="noborder"
    type="checkbox"
    src="select_all_icon.gif"
    name="selectButton"
    title="Select all items"
    onClick="toggleSelect(this);"
    tal:attributes="src string:$portal_url/select_all_icon.gif"
    alt="Select all items"
    i18n:attributes="title; alt"
    />
</th>
<th i18n:translate="label_title">Title</th>
<th i18n:translate="label_category">Category</th>
<th i18n:translate="label_report_dry_matter">Report as dry matter</th>
<th i18n:translate="label_attachments">Attachments</th>
<th i18n:translate="label_unit">Unit</th>
<th i18n:translate="label_price_excl_vat">Price excluding VAT</th>
<th i18n:translate="label_corporate_price_excl_vat">Corporate price excluding VAT</th>
<th i18n:translate="label_maximum_hours_allowed">Maximum Hours Allowed</th>
<th i18n:translate="label_duplicate_variation">Duplicate Variation</th>
<th i18n:translate="label_calc">Calc</th>
</tr>
</thead>

<tbody tal:define="getRelativeContentURL nocall:utool/getRelativeContentURL">

<metal:block tal:repeat="item batch">
<tr tal:define="
        oddrow repeat/item/odd;
        obj item/getObject;
        reportdry obj/getReportDryMatter;
        item_title_or_id obj/title_or_id"
    tal:attributes="
        class python:test(oddrow, 'even', 'odd')" >
<td tal:condition="ar_action">
<input type="checkbox" class="noborder" name="ids:list" id="#" value="#"
    tal:attributes="
        value obj/getId;
        id python: 'cb_'+obj.getId();
        checked request/ids_checked|nothing;
        tabindex tabindex/next|nothing;
        alt string:Select $item_title_or_id;
        title string:Select $item_title_or_id"/>
<input type="hidden" name="obj_paths:list" value="#"
    tal:attributes="value python:getRelativeContentURL(obj)" />
</td>

<td>
<a href="" 
    tal:attributes="href obj/absolute_url"
    tal:content="obj/Title">A service</a>
</td>
<td>
<a href="" 
    tal:define="cat obj/getAnalysisCategory"
    tal:attributes="href cat/absolute_url|nothing"
    tal:content="cat/Title|nothing">A category</a>
</td>
<td tal:content="python:reportdry and 'Yes' or 'No'"></td>
<td tal:define="vocab python:obj.Schema()['AttachmentOption'].Vocabulary()"
    tal:content="python:vocab.getMsgId(obj.getAttachmentOption())"></td>
<td tal:content="obj/getUnit"></td>
<td tal:content="obj/getPrice"></td>
<td tal:content="obj/getCorporatePrice"></td>
<td tal:content="obj/getMaxHoursAllowed"></td>
<td tal:content="obj/getDuplicateVariation"></td>
<td tal:content="obj/getCalcName"></td>
</tr>
</metal:block>

</tbody>

</table>


<!-- Navigation -->
<div metal:use-macro="here/batch_macros/macros/navigation" />

<tal:buttons tal:repeat="button actions/folder_buttons|nothing">
<input
    class="context"
    type="submit"
    name=""
    value=""
    tabindex=""
    tal:condition="python:batch and button['id'] == 'delete'"
    i18n:attributes="value"
    tal:attributes="
        value button/name;
        name button/url;
        tabindex tabindex/next" />
</tal:buttons>

<input
    tal:condition="python:batch"
    class="context"
    type="submit"
    name="duplicate_service:method"
    value="duplicate"
/>

</form>

</div>
</div>

</body>
</html>
