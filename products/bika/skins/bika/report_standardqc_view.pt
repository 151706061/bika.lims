<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bika">

<head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border', 1)" />

    <metal:calendar fill-slot="javascript_head_slot">
        <!-- ECMAScript calendar -->
        <style type="text/css" media="all"
            tal:content="string:@import url($portal_url/jscalendar/calendar-system.css);"></style>
        <script type="text/javascript"
            tal:attributes="src string:$portal_url/jscalendar/calendar_stripped.js"></script>
        <script type="text/javascript" charset="iso-8859-1"
            tal:condition="exists: portal/jscalendar/calendar-en.js"
            tal:attributes="src string:$portal_url/jscalendar/calendar-en.js"></script>
    </metal:calendar>

</head>
<body>
<div metal:fill-slot="main"
    tal:define="form_submitted request/submit|nothing">


<script type="text/javascript" src="utils.js"></script>
<div metal:use-macro="here/document_actions/macros/document_actions">
Document actions (print, sendto etc)
</div>

<metal:block use-macro="here/report_standardqc_print/macros/header"/>

<tal:parameters condition="not:form_submitted">
<tal:selection
    tal:define="
        at_analysis python:here.portal_type == 'StandardAnalysis';
        at_sample python:here.portal_type == 'StandardSample';
        at_home python:not at_analysis and not at_sample;
        supplier_uid python:at_analysis and here.aq_parent.aq_parent.UID() or (at_sample and here.aq_parent.UID() or request.get('getStandardSupplierUID', None));
        supplier python:supplier_uid and here.reference_catalog.lookupObject(supplier_uid) or None; 
        sample_uid python:at_sample and here.UID() or (at_analysis and here.aq_parent.UID() or request.get('getStandardSampleUID', None)) ;
        sample python:sample_uid and here.reference_catalog.lookupObject(sample_uid) or None; 
        service_uid python:at_analysis and here.getService().UID() or request.get('getServiceUID', None);
        service python:service_uid and here.reference_catalog.lookupObject(service_uid) or None; 
        analysis_uid python:at_analysis and here.UID() or None;
">

<form action="report_standardqc_view" method="post" name="search">
<fieldset>

<legend i18n:translate="legend_selection_criteria">Selection criteria</legend>

<form name="filter_result" action="." method="post" name="search"
    tal:attributes="action template/getId">

<div class="field"
    tal:condition="at_home">
    <label i18n:translate="label_supplier"
        >Supplier</label><br/>
    <select name="getStandardSupplierUID" 
            onChange="string:clearSampleAndService();this.form.submit()"
            style=""
            id="getStandardSupplierUID"
            tal:attributes="
                style string:font-family:${here/base_properties/fontFamily};;font-size:100%;
                ">
        <option value=""/>

        <tal:suppliers
            define="    
                suppliers python:here.portal_catalog(portal_type='StandardSupplier');
                sort_on python:(('Title', 'nocase', 'asc'),);
                suppliers python:sequence.sort(suppliers, sort_on);"
            repeat="supplier suppliers">
        <option value=""
            tal:define="this_uid python:supplier.getObject().UID()"
            tal:attributes="value this_uid;
                selected python:supplier_uid == this_uid and 'selected' or ''"
            tal:content="supplier/Title"
            >Acme Systems</option>

        </tal:suppliers>
    </select>
</div>

<tal:not_selected tal:condition="at_home">
<div class="field">
    <label i18n:translate="label_standard"
        >Standard</label><br/>
    <select name="getStandardSampleUID" 
            onChange="this.form.submit()"
            style="" id="getStandardSampleUID">
        <option value=""/>
        <tal:standards
            define="    
                standards python:supplier and supplier.objectValues('StandardSample') or [];
                sort_on python:(('Title', 'nocase', 'asc'),);
                standards python:sequence.sort(standards, sort_on);"
            tal:repeat="standard standards">
        <option value=""
            tal:define="this_uid python:standard.UID()"
            tal:attributes="value this_uid;
                selected python:sample_uid == this_uid and 'selected' or ''"
            tal:content="standard/Title"
            >sugar</option>
        </tal:standards>
    </select>
</div>
</tal:not_selected>

</form>

<form action="report_standardqc_view" method="post" name="search">
<tal:not_selected tal:condition="python:not at_analysis">
<div class="field">
    <label i18n:translate="label_analysisservice"
        >Analysis</label><br/>
    <select name="getServiceUID" 
            style="" id="getServiceUID">
        <tal:analyses
            define="    
                services python:sample and sample.getServices() or [];
                sort_on python:(('Title', 'nocase', 'asc'),);
                services python:sequence.sort(services, sort_on);"
            tal:repeat="service services">
        <option value=""
            tal:define="this_uid python:service.UID()"
            tal:attributes="value this_uid;
                selected python:service_uid == this_uid and 'selected' or ''"
            tal:content="service/Title"
            >Alcohol</option>
        </tal:analyses>
    </select>
</div>
</tal:not_selected>

<tal:dates
    tal:define="
        now python:DateTime();
        past python:now - 60">
<div class="field">
    <label i18n:translate="label_dateverified"
        >Date verified</label><br/>
    <span i18n:translate="label_from">From</span>

    <tal:define define="
        id string:getDateVerified_fromdate;
        inputname id;
        formname string:search;
        value past;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/calendar_macros/macros/calendarDatePickerBox">
        a calendar, hopefully
    </metal:use>
    </tal:define>

    <span i18n:translate="label_to">to</span>

    <tal:define define="
        id string:getDateVerified_todate;
        inputname id;
        formname string:search;
        value now;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/calendar_macros/macros/calendarDatePickerBox">
        a calendar, hopefully
    </metal:use>
    </tal:define>

</div>

</tal:dates>
<input type="HIDDEN" name="getStandardSupplierUID"
    value=""
    tal:attributes="value supplier_uid"/>
<input type="HIDDEN" name="getStandardSampleUID"
    value=""
    tal:attributes="value sample_uid"/>
<input 
    type="HIDDEN" name="getAnalysisUID"
    value=""
    tal:condition="at_analysis"
    tal:attributes="value analysis_uid"/>
<input type="HIDDEN" name="getServiceUID"
    value=""
    tal:condition="at_analysis"
    tal:attributes="value service_uid"/>
<input type="HIDDEN" name="portal_type"
    value="StandardAnalysis"/>
<input tabindex=""
    class="searchButton"
    type="submit"
    name="submit"
    value="Stats"
    i18n:attributes="value"
    />                       

</form>
</tal:selection>
</tal:parameters>

<tal:results condition="form_submitted">
<form name="report_standardqc_print" action="." method="post">
<input type="hidden" name="getDateVerified_fromdate"
    tal:attributes="value python:request.get('getDateVerified_fromdate', None)">
<input type="hidden" name="getDateVerified_todate"
    tal:attributes="value python:request.get('getDateVerified_todate', None)">
<input type="HIDDEN" name="getStandardSupplierUID"
    value=""
    tal:attributes="value python:request.get('getStandardSupplierUID', None)"/>
<input type="HIDDEN" name="getStandardSampleUID"
    value=""
    tal:attributes="value python:request.get('getStandardSampleUID', None)"/>
<input 
    type="HIDDEN" name="getAnalysisUID"
    value=""
    tal:attributes="value python:request.get('getAnalysisUID', None)"/>
<input type="HIDDEN" name="getServiceUID"
    value=""
    tal:attributes="value python:request.get('getServiceUID', None)"/>
<input
    class="printButton"
    type="submit"
    name="report_standardqc_print:method"
    value="Print"
    tabindex=""
    i18n:attributes="value"
    tal:attributes="
        tabindex tabindex/next|nothing"/>
        
</form>
<metal:block use-macro="here/report_standardqc_print/macros/body"/>
</tal:results>
</div>
</body>

</html>
