<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<metal:block use-macro="here/global_defines/macros/defines" />

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      tal:attributes="lang default_language|default;
                      xml:lang default_language|default;"
      i18n:domain="bika">

<head metal:use-macro="here/header/macros/html_header">

<metal:fillbase fill-slot="base">
    <base href="" tal:attributes="href here/renderBase" />
</metal:fillbase>

<metal:headslot fill-slot="head_slot"
                tal:define="language here/Language;
                            lang language | default_language;
                            charset site_properties/default_charset|string:utf-8">

    <metal:cache use-macro="here/global_cache_settings/macros/cacheheaders">
    Get the global cache headers located in global_cache_settings.
    </metal:cache>

</metal:headslot>

</head>

<body style="font-size: 100%;font-family:Arial, 'Lucida Grande', Verdana, Lucida, Helvetica, sans-serif;" onload="this.print()"
    tal:define="invoice python:here">

    <img src="" tal:attributes="src string:${portal_url}/lab_logo.jpg"/>

    <br/>

<metal:block define-macro="invoice">

<h3 align="center" i18n:translate="label_tax_invoice">Tax Invoice</h3>

<table class="invoice"
    thead tal:define="client invoice/getClient">
<tr>
<th width="50%" tal:define="mailing python:here.get_billing_address(client, outerJoin='\n')">
<br/>

    <strong tal:content="client/Title|nothing">Clientname</strong>
<br/>
    <span tal:content="structure python:modules['Products.PythonScripts.standard'].newline_to_br(mailing)">Client address</span>
<br/>
<tal:phone tal:condition="client/getPhone">
<br/>
    <strong i18n:translate="label_telephone_abbreviation">Tel:</strong> 
    <span tal:replace="client/getPhone">888 0000</span>
</tal:phone>
<tal:fax tal:condition="client/getFax">
<br/>
    <strong  i18n:translate="label_fax_abbreviation">Fax:</strong> 
    <span tal:replace="client/getFax">888 0000</span>
</tal:fax>
<br/>
<br/>
</th>

<th>
    <strong i18n:translate="header_monthly_invoice">Monthly invoice:</strong>
    <strong tal:content="invoice/getInvoiceNumber">S001</strong>
<br/>
    <strong i18n:translate="header_account">Account #:</strong>
    <strong tal:content="client/getAccountNumber|nothing">1000</strong>
<br/>
    <strong i18n:translate="header_date">Date:</strong>
    <span tal:replace="python:DateTime().strftime('%d %b %Y')"/>
<br/>
    <strong i18n:translate="header_date_range">Date range:</strong>
    <span tal:define="startdate python:invoice.aq_parent.getBatchStartDate()"
        tal:replace="python:plone_view.toLocalizedTime(startdate)"/>
        to
    <span tal:define="enddate python:invoice.aq_parent.getBatchEndDate()"
        tal:replace="python:plone_view.toLocalizedTime(enddate)"/>
</th>
</table>

<table class="invoice">
<thead>
<tr>
<th i18n:translate="label_date">Date</th>
<th i18n:translate="label_description">Description</th>
<th i18n:translate="label_order_number">Order #</th>
<th class="amount" i18n:translate="label_amount">Amount</th>
<th class="amount" i18n:translate="label_vat">VAT</th>
<th class="amount" i18n:translate="label_amount_incl_vat">Amount incl VAT</th>
</tr>

</thead>

<tbody
    tal:define="
        sort_on python:(('getClientOrderNumber', 'nocase', 'asc'),);
        items python:invoice.objectValues('InvoiceLineItem');
        global last_sub_needed python:0;
        global sub_amount python:0;
        global sub_vat python:0;
        global sub_total python:0;
        global old_order python:'nothing here'">

<tal:line_item tal:repeat="item python:sequence.sort(items, sort_on)">
<tal:order_number
    tal:define="this_order python:item.getClientOrderNumber() or ''">
<tal:new_order 
tal:condition="python:(old_order != 'nothing here') and (this_order != old_order)">
<tr>
<th>&nbsp</th>
<th>&nbsp</th>
<th>Sub Total:</th>
<th class="amount" tal:content="sub_amount">10.00</th>
<th class="amount" tal:content="sub_vat">1.14</th>
<th class="amount" tal:content="sub_total">11.14</th>
<tal:reset tal:define="
        global last_sub_needed python:1;
        global sub_amount python:0;
        global sub_vat python:0;
        global sub_total python:0"/>
</tr>
<tr>
<td>&nbsp</td>
<td>&nbsp</td>
<td>&nbsp</td>
<td>&nbsp</td>
<td>&nbsp</td>
<td>&nbsp</td>
</tr>
</tal:new_order>

<tr tal:define="global old_order this_order">
<td tal:content="python:item.getItemDate().strftime('%d %b %Y')"
    >2005-01-01</td>
<td tal:content="structure python:here.format_invoicelineitem(item.getItemDescription())">AR-0001</td>
<td tal:content="python:item.getClientOrderNumber() or ''">Order No</td>
<td class="amount" 
    tal:content="item/getSubtotal"
    tal:define="global sub_amount python:sub_amount + item.getSubtotal()">
    10.00</td>
<td class="amount" 
    tal:content="item/getVAT"
    tal:define="global sub_vat python:sub_vat + item.getVAT()">
    1.14</td>
<td class="amount" 
    tal:content="item/getTotal"
    tal:define="global sub_total python:sub_total + item.getTotal()">
    11.14</td>
</tr>
</tal:order_number>
</tal:line_item>

</tbody>

<tfoot class="footer">
<tr tal:condition="last_sub_needed">
<th>&nbsp</th>
<th>&nbsp</th>
<th>Sub Total:</th>
<th class="amount" tal:content="sub_amount">10.00</th>
<th class="amount" tal:content="sub_vat">1.14</th>
<th class="amount" tal:content="sub_total">11.14</th>
<tal:reset tal:define="
        global sub_amount python:0;
        global sub_vat python:0;
        global sub_total python:0"/>
</tr>
<tr>
<tr></tr>
<tr>
<th>
<span tal:replace="python:invoice.getBatchEndDate().strftime('%Y %b')"/>
</th>
<th></th>
<th i18n:translate="label_total">Total</th>
<th nowrap class="amount"><span i18n:translate="label_currency_abbreviation"> R</span> 
<span tal:content="invoice/getSubtotal">10.00</span></th>
<th nowrap class="amount"><span i18n:translate="label_currency_abbreviation"> R</span> 
<span tal:content="invoice/getVAT">1.14</span></th>
<th nowrap class="amount"><span i18n:translate="label_currency_abbreviation"> R</span> 
<span tal:content="invoice/getTotal">11.14</span></th>
</tr>
<tr></tr>
<tr></tr>
</tfoot>

</table>

<!--    proprietary information
<p>
<span i18n:translate="disclaimer_conditions">
Acme Analytical Services (Pty) Ltd conditions of business apply</span></p>

<p>
<span i18n:translate="disclaimer_terms">
Terms: 30 days nett
</span></p>

<p>
<span>Account Name: Acme Analytical Services (Pty) Ltd</span><br/>
<span>Savings Bank </span><br/>
<span>Some Branch</span><br/>
<span>Branch Code: 123456</span><br/>
<span>Account #: 12356</span><br/>
</p>
-->

</metal:block>

</body>

</html>



