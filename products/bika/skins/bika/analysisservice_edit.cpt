<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="bika">

<head>
<title></title></head>
<body>
<div metal:fill-slot="prefs_configlet_main"
    tal:define="
        errors options/state/getErrors">

<script type="text/javascript" src="utils.js"></script>


<tal:error repeat="error python:errors.keys()">
<tal:x define="message python:errors[error]">
<p class="portalMessage">
<span tal:content="error">field</span>:
<span tal:content="message">Error</span> </p>
</tal:x>
</tal:error>
<h1>
    <img src="service.png" tal:attributes="src python:here.portal_types.getTypeInfo('AnalysisService').getIcon()"/>
    <span tal:omit-tag="" i18n:translate="heading_analysis_service_edit"
        >Analysis service</span>
</h1>

<!--
<div metal:use-macro="here/document_actions/macros/document_actions">
    Document actions (print, sendto etc)
</div>
-->

<form name="edit_form"
    method="post"
    enctype="multipart/form-data"
    action=""
    tal:attributes="action python:here.absolute_url()+'/'+template.id"
    autocomplete="off">

<input type="hidden" name="form.submitted" value="1" />

<br/>

<div class="field">
<label i18n:translate="label_title">Title</label>
    &nbsp;<span class="fieldRequired">(Required)</span>
<div> </div>
<input name="Title" value="" size="100"
    tal:attributes="value request/Title | here/Title"/>
</div>

<fieldset>
<legend i18n:translate="label_general">General</legend>

<div class="field">
<label i18n:translate="label_description">Description</label>
<div> </div>
<textarea name="ServiceDescription" rows="5" cols="40"
    tal:content="request/ServiceDescription | here/getServiceDescription"></textarea>
</div>

<div class="field">
<label i18n:translate="label_instructions">Instructions</label>
<div> </div>
<textarea name="Instructions" rows="5" cols="40"
    tal:content="request/Instructions | here/getInstructions"></textarea>
</div>
<div class="field"
    tal:define="
        instruments python:[p.getObject() for p in here.portal_catalog(portal_type='Instrument')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        instruments python:sequence.sort(instruments, sort_on)">
<label i18n:translate="label_instrument">Instrument</label>
<div> </div>
    <select name="Instrument"
        tal:define="
            old python:here.getInstrument() and here.getInstrument().UID() or None;
            prev python:request.get('Instrument', old)">
    <option></option>
    <tal:item 
        tal:repeat="instrument instruments">
    <option selected="selected"
        tal:define="
            this_selected python:test(instrument.UID() == prev, 'selected', '')"
        tal:attributes="value instrument/UID;
            selected this_selected"
        tal:content="instrument/Title"></option>
    </tal:item>
    </select>
</div>


<div class="field"
    tal:define="
        methods python:[p.getObject() for p in here.portal_catalog(portal_type='Method')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        methods python:sequence.sort(methods, sort_on)">
<label i18n:translate="label_method">Method</label>
<div> </div>
    <select multiple="multiple" name="Method:List"
        tal:define="
            prev python:request.get('Method', []);
            old python:prev and prev or [s.UID() for s in here.getMethod()];">

    <tal:item 
        tal:repeat="method methods">
    <option selected="selected"
        tal:define="
            this_selected python:test(method.UID() in old, 'selected', '')"
        tal:attributes="value method/UID;
            selected this_selected"
        tal:content="method/Title"></option>
    </tal:item>

    </select>
</div>


<div class="field"
    tal:define="
        departments python:[p.getObject() for p in here.portal_catalog(portal_type='Department')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        departments python:sequence.sort(departments, sort_on)">
<label i18n:translate="label_department">Lab department</label>
&nbsp;<span class="fieldRequired">(Required)</span>
<div> </div>
    <select name="Department"
        tal:define="
            old python:here.getDepartment() and here.getDepartment().UID() or None;
            prev python:request.get('Department', old)">
    <option></option>
    <tal:item 
        tal:repeat="department departments">
    <option selected="selected"
        tal:define="
            this_selected python:test(department.UID() == prev, 'selected', '')"
        tal:attributes="value department/UID;
            selected this_selected"
        tal:content="department/Title"></option>
    </tal:item>
    </select>
</div>


<div class="field"
    tal:define="
        categories python:[p.getObject() for p in here.portal_catalog(portal_type='AnalysisCategory')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        categories python:sequence.sort(categories, sort_on)">
<label i18n:translate="label_category">Analysis service category</label>
&nbsp;<span class="fieldRequired">(Required)</span>
<div> </div>
    <select name="AnalysisCategory"
        tal:define="
            old python:here.getAnalysisCategory() and here.getAnalysisCategory().UID() or None;
            prev python:request.get('AnalysisCategory', old)">
    <option></option>
    <tal:item 
        tal:repeat="category categories">
    <option selected="selected"
        tal:define="
            this_selected python:test(category.UID() == prev, 'selected', '')"
        tal:attributes="value category/UID;
            selected this_selected"
        tal:content="category/Title"></option>
    </tal:item>
    </select>
</div>


<div class="field">
<input class="noborder" type="checkbox" value=""
    id="Accredited" name="Accredited_visible"
    onclick="toggleBoolean('Accredited', 'Accredited_hidden'); return 1"
    tal:attributes="checked request/Accredited | here/getAccredited" />
<input type="hidden" name="Accredited" value=""
    id="Accredited_hidden"
    tal:attributes="value request/Accredited | here/getAccredited" />
<label i18n:translate="label_accredited">Accredited</label>
</div>

</fieldset>

<fieldset>
<legend i18n:translate="label_identification">Identification</legend>
<div class="field">
<label i18n:translate="label_instrument_import_keyword">Instrument Import Keyword</label>
<div class="formHelp" i18n:translate="label_vat_percentage">
    The name of the service in the CSV file exported by the analytic instrument
</div>
<input name="InstrumentKeyword" value=""
    tal:attributes="value request/InstrumentKeyword | here/InstrumentKeyword"/>
</div>

<div class="field">
<label i18n:translate="label_analysis_keyword">Analysis Keyword</label>
<div class="formHelp" i18n:translate="label_vat_percentage">
The analysis identifier
</div>
<input name="AnalysisKey" value=""
    tal:attributes="value request/AnalysisKey | here/AnalysisKey"/>
</div>
</fieldset>

<fieldset>
<legend i18n:translate="label_reporting">Reporting</legend>
<div class="field">
<input class="noborder" type="checkbox" value=""
    id="ReportDryMatter" name="ReportDryMatter_visible"
    onclick="toggleBoolean('ReportDryMatter', 'ReportDryMatter_hidden'); return 1"
    tal:attributes="checked request/ReportDryMatter | here/getReportDryMatter" />
<input type="hidden" name="ReportDryMatter" value=""
    id="ReportDryMatter_hidden"
    tal:attributes="value request/ReportDryMatter | here/getReportDryMatter" />
<label i18n:translate="label_report_as_dry_matter">Report as dry matter</label>
</div>

<div class="field">
<label i18n:translate="label_attachments">Attachments</label>
<div> </div>
<tal:options 
    tal:define="attachments python:here.Schema()['AttachmentOption'].Vocabulary()"
    tal:repeat="attachment attachments">
<input class="noborder" type="radio"
    checked="" name="AttachmentOption" value=""
    tal:attributes="value attachment;
        checked python:attachment == here.getAttachmentOption()"/>

<label tal:content="python:here.translate(attachments.getValue(attachment))"></label>

<br />
</tal:options>
</div>

<div class="field">
<label i18n:translate="label_unit">Unit</label>
<div> </div>
<input name="Unit" value=""
    tal:attributes="value request/Unit | here/Unit"/>
</div>

<div class="field">
<label i18n:translate="label_titration_unit">Titration Volume Unit</label>
<div> </div>
<input name="TitrationUnit" value=""
    tal:attributes="value request/TitrationUnit | here/TitrationUnit"/>
</div>

<div class="field">
<label i18n:translate="label_precision_as_decimals">Precision</label>
<div class="formHelp"
    i18n:translate="label_number_of_decimals">Number of decimals for result
</div>
<input name="Precision" value="" size="5"
    tal:attributes="value request/Precision | here/Precision"/>
</div>


<div class="field">
<label i18n:translate="label_duplicate_variation">Duplicate Variation</label>
<div class="formHelp" i18n:translate="label_duplicate_variation">
Permitted variation as percentage
</div>
<input name="DuplicateVariation" value="" size="5"
    tal:attributes="value request/DuplicateVariation | here/DuplicateVariation"/>
</div>

</fieldset>

<fieldset>
<legend i18n:translate="label_pricing">Pricing</legend>
<div class="field">
<label i18n:translate="label_price_excl_vat">Price excluding VAT</label>
<div> </div>
<input name="Price" value="" size="5"
    tal:attributes="value request/Price | here/Price"/>
</div>

<div class="field">
<label i18n:translate="label_corporate_price">Corporate price excluding VAT</label>
<div> </div>
<input name="CorporatePrice" value="" size="5"
    tal:attributes="value request/CorporatePrice | here/CorporatePrice"/>
</div>

<div class="field">
<label i18n:translate="label_vat">VAT %</label>
<div class="formHelp" i18n:translate="label_vat_percentage">
    Enter percentage value eg. 14 </div>
<input name="VAT" value="" size="5"
    tal:attributes="value request/VAT | here/VAT"/>
</div>
</fieldset>

<fieldset>
<legend i18n:translate="label_calculations">Calculations</legend>

<div class="field" >
<label i18n:translate="label_result_options">Result options</label>
<div class="formHelp" i18n:translate="label_result_options">
    Restricted set of result options </div>
<tal:old 
    tal:define="options python:here.getResultOptionsSorted()"
    tal:repeat="option options">
<input name="" value="" size="10"
    tal:define="seq repeat/option/index"
    tal:attributes="name string:ResultOptions.${seq}:record:ignore_empty;
                    value python:option"/>
<br/>
</tal:old>
<tal:new tal:repeat="i python:range(3)">
<input name="" value="" size="10"
    tal:define="seq python:len(here.getResultOptions()) + i"
    tal:attributes="name string:ResultOptions.${seq}:record:ignore_empty"/>
<br/>
</tal:new>
</div>

<div class="field"
    tal:define="
        calctypes python:[p.getObject() for p in here.portal_catalog(portal_type='CalculationType')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        calctypes python:sequence.sort(calctypes, sort_on)">
<label i18n:translate="label_calc_type">Calculation Type</label>
<div> </div>
    <select name="CalculationType"
        tal:define="
            old python:here.getCalculationType() and here.getCalculationType().UID() or None;
            prev python:request.get('CalculationType', old)">
    <option></option>
    <tal:item 
        tal:repeat="calctype calctypes">
    <option selected="selected"
        tal:define="
            this_selected python:test(calctype.UID() == prev, 'selected', '')"
        tal:attributes="value calctype/UID;
            selected this_selected"
        tal:content="calctype/Title"></option>
    </tal:item>
    </select>
</div>

<div class="field"
    tal:define="
        services python:[p.getObject() for p in here.portal_catalog(portal_type='AnalysisService')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        services python:sequence.sort(services, sort_on)">
<label i18n:translate="label_dependant_analyses">Dependant Analyses</label>
<div> </div>
    <select multiple="multiple" name="CalcDependancy:List"
        tal:define="
            prev python:request.get('CalcDependancy', []);
            old python:prev and prev or [s.UID() for s in here.getCalcDependancy()];">

    <tal:item 
        tal:repeat="service services">
    <option selected="selected"
        tal:define="
            this_selected python:test(service.UID() in old, 'selected', '')"
        tal:attributes="value service/UID;
            selected this_selected"
        tal:content="service/Title"></option>
    </tal:item>

    </select>
</div>


<div class="field">
<label i18n:translate="label_max_hours">Maximum Hours Allowed</label>
<div class="formHelp" i18n:translate="label_maximum_hours_allowed">
Maximum time allowed for publication of results
</div>
<input name="MaxHoursAllowed" value="" size="5"
    tal:attributes="value request/MaxHoursAllowed | here/MaxHoursAllowed"/>
</div>

</fieldset>

<div class="field">
<fieldset>
<legend i18n:translate="label_uncertainties">Uncertainties</legend>
<table
    tal:define="uncertainties request/Uncertainties | here/getUncertainties">
<tr> 
<td i18n:translate="label_min">Min</td>
<td i18n:translate="label_max">Max</td>
<td i18n:translate="label_actual_value">Actual value</td>
<td>
<span i18n:translate="delete">delete</span>
</td>
</tr>
<tal:uncertainty tal:repeat="uncertainty uncertainties">
<tr>
<div>
<td>
<input type="text"
    name="Uncertainties.intercept_min:records:ignore_empty"
    value="" size="10" maxlength="40"
    tal:attributes="value uncertainty/intercept_min" />
</td>
</div>
<div>
<td>
<input type="text"
    name="Uncertainties.intercept_max:records:ignore_empty"
    value="" size="10" maxlength="40" 
    tal:attributes="value uncertainty/intercept_max" />
</td>
</div>
<div>
<td>
<input type="text"
    name="Uncertainties.errorvalue:records:ignore_empty"
    value="" size="10" maxlength="40" 
    tal:attributes="value uncertainty/errorvalue" />
</td>
</div>
<td tal:define="row repeat/uncertainty/number">
<input class="noborder" type="checkbox" value="on"
    name="Uncertainties.delete:records:ignore_empty">
</td>
</tr>
</tal:uncertainty>
<tr>
<div>
<td>
<input type="text"
    name="Uncertainties.intercept_min:records:ignore_empty"
    value="" size="10" maxlength="40" />
</td>
</div>
<div>
<td>
<input type="text"
    name="Uncertainties.intercept_max:records:ignore_empty"
    value="" size="10" maxlength="40" />
</td>
</div>
<div>
<td>
<input type="text"
    name="Uncertainties.errorvalue:records:ignore_empty"
    value="" size="10" maxlength="40" />
</td>
</div>
<td>
</td>
</tr>
</table>

</fieldset>
       
</div>



<input class="context"
        type="submit"
        name="form.button.submit"
        value="Save"
        i18n:attributes="value"
        />
<input class="standalone"
        type="submit"
        name="form.button.cancel"
        value="Cancel"
        i18n:attributes="value"
        />

</form>

</div>

</body>

</html>


