<html
    xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
    i18n:domain="bika"
    metal:use-macro="here/main_template/macros/master">

<head>

<metal:block fill-slot="top_slot"
    tal:define="dummy python:request.set('disable_border', 1)" />
</head>

<body>

<div metal:fill-slot="main"
    tal:define="
        dummy_a python:request.set('portal_type', 'Worksheet');
        dummy_b python:request.set('sort_on', 'getNumber');
        dummy_c python:request.set('sort_order', 'reverse');
        dummy_d python:here.toggle_state('worksheet_review_state', 'all');
        worksheet_state python:request.get('worksheet_review_state');
        dummy_e python:here.REQUEST.set('review_state', worksheet_state);
        states python:here.get_toggles('worksheet');
        header_state python:here.get_toggle_title(worksheet_state, states)">

<div metal:use-macro="here/document_actions/macros/document_actions">
Document actions (print, sendto etc)
</div>

<h1>
<img src="worksheet.png" tal:attributes="src python:here.portal_types.getTypeInfo('Worksheet').getIcon()"/>
<span i18n:translate="heading_worksheets">Worksheets</span>
<tal:not_all tal:condition="python:worksheet_state != 'all'">
-
<span i18n:translate="" tal:content="header_state">All</span>
</tal:not_all>
</h1>

<br/>

<form name="add_worksheet" action="." method="post">

<input
    class="standalone"
    type="submit"
    name="worksheet_add:method"
    value="Add New Worksheet"
    tabindex=""
    i18n:domain="bika"
    i18n:attributes="value"
    tal:attributes="
        tabindex tabindex/next|nothing"
        />
&nbsp
<tal:template
    tal:define="templates python:[p.getObject() 
    for p in here.portal_catalog(portal_type='WorksheetTemplate')];
    sort_on python:(('Title', 'nocase', 'asc'),);
    templates python:sequence.sort(templates, sort_on);"
    tal:condition="templates">
<label i18n:translate="label_using_template">using template</label>

<select name="WorksheetTemplate">
    <option>None</option>
<tal:templates repeat="template templates">
    <option 
        tal:attributes="value template/UID"
        tal:content="template/title">Title</option>
</tal:templates>
</select>
</tal:template>
</form>

<br/>

<form name="filter_result" action="" method="post" 
    tal:attributes="action template/getId">
<input type="hidden" name="portal_type" value="Worksheet"/>
<input type="hidden" name="sort_on" value="getNumber"/>
<input type="hidden" name="sort_order" value="reverse"/>
<div class="optionsToggle">
    <tal:x repeat="state states">
    <input class="noborder" type="radio" name="worksheet_review_state" value="all"
        onclick="this.form.submit()"
        tal:define="state_id state/id"
        tal:attributes="value state_id;
            checked python:request.get('worksheet_review_state', 'all') == state_id and 'checked' or None"/>
    <span tal:content="state/title" i18n:translate="">All</span>
    </tal:x>
</div>
</form>
<div id="content-worksheets"
    tal:define="
        all python:worksheet_state == 'all';
        results python:test(all, here.portal_catalog(
                    portal_type='Worksheet',
                    sort_on='getNumber',
                    sort_order='reverse'), 
                    container.queryCatalog());
        Batch python:modules['Products.CMFPlone'].Batch;
        b_start python:request.get('b_start',0);">

<form name="Worksheets" method="post" action="." tal:condition="results"
    tal:define="
        canDelete python:(worksheet_state == 'open') and checkPermission('Delete objects', here);
        batch python:Batch(results, 15, int(b_start), orphan=1)">
<input type="hidden" name="form.submitted" value="1" />
<input type="hidden" name="came_from" value="worksheets" />
<table
    class="listing"
    summary="worksheet listing"
    cellpadding="0" cellspacing="0">

<thead>
<tr>
<th class="nosort"
    tal:condition="canDelete">
<input
    class="noborder"
    type="checkbox"
    src="select_all_icon.gif"
    name="selectButton"
    title="Select all items"
    onClick="toggleSelect(this, 'paths:list');"
    tal:attributes="src string:$portal_url/select_all_icon.gif"
    alt="Select all items"
    i18n:attributes="title; alt"
    />
</th>
<th i18n:translate="label_worksheetnumber">Worksheet number</th>
<th i18n:translate="label_owner">username</th>
<th i18n:translate="label_worksheet_creation_date">2006-01-01</th>
<th i18n:translate="label_linked_worksheets">Linked Worksheets</th>
<th tal:condition="python:worksheet_state == 'all'" 
    i18n:translate="label_status">Status</th>
</tr>
</thead>


<tbody tal:define="getRelativeContentURL nocall:utool/getRelativeContentURL">

<metal:block tal:repeat="result batch">
<tal:item define="item result/getObject">
<tr tal:define="
        oddrow repeat/result/odd;
        item_title_or_id item/title_or_id;
        item_state python:test(worksheet_state == 'all', 
                        wtool.getInfoFor(item, 'review_state', ''), 
                        worksheet_state)"
    tal:attributes="
        class python:test(oddrow, 'even', 'odd')" >

<td tal:condition="canDelete">
<input type="checkbox" class="noborder" name="paths:list" id="#" value="#"
    tal:attributes="
        value   python:'/'.join(item.getPhysicalPath());
        id      python: 'cb_'+item.getId();
        checked python:test(request.get('ids_checked', False), 'checked', None);
        alt     string:Select $item_title_or_id;
        title   string:Select $item_title_or_id" />

<input type="hidden" name="obj_paths:list" value="#"
    tal:attributes="value python:getRelativeContentURL(item)" />
</td>

<td><a href="" tal:content="item/getNumber"
    tal:attributes="href item/absolute_url">WS-0001</a></td>
<td tal:content="item/getOwnerUserID">username</td>
<td tal:content="python:plone_view.toLocalizedTime(item.CreationDate(), long_format=1)"
    >2005-01-01 10:10</td>
<td> 
<tal:links
    tal:define="linkedws item/getLinkedWorksheet |nothing"
    tal:repeat="ws linkedws">
<p><a href=""
    tal:content="ws/getNumber"
    tal:attributes="href ws/absolute_url">WS-0002</a></p>
</tal:links>
</td>
<td tal:condition="python:worksheet_state == 'all'" 
    tal:content="python:item_state.replace('_', ' ')">
</td>
</tr>

</tal:item>
</metal:block>
</tbody>

</table>
<!-- Navigation -->
<div metal:use-macro="here/batch_macros/macros/navigation" />

<tal:buttons tal:repeat="button actions/folder_buttons|nothing">
<input
    class="context"
    type="submit"
    name=""
    value=""
    tabindex=""
    tal:condition="python:batch and (canDelete and (button['id'] in ('delete')))"
    i18n:attributes="value"
    tal:attributes="
        value button/name;
        name button/url;
        tabindex tabindex/next" />
</tal:buttons>

<input type="hidden" name="orig_template"
        tal:attributes="value template_id"/>
</form>

</div>
</div>

</body>
</html>
