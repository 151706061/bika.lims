<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    i18n:domain="bika">

<head><title></title></head>

<body>

<metal:view_macro define-macro="view">
<tal:define define="refs python:here.getReferenceImpl(field.relationship)"
                condition="refs">
<ul>
<li tal:repeat="ref refs">
<div
    tal:define="obj ref/getTargetObject"
    tal:content="obj/Title">
Analysis Request XYZ
</div>
</li>
</ul>

</tal:define>
</metal:view_macro>

<metal:edit_macro define-macro="edit">
<metal:use use-macro="field_macro | here/widgets/field/macros/edit">

<div
    metal:fill-slot="widget_body"
    tal:define="multiVal field/multiValued;
        vocab python:field.Vocabulary(here);
        fieldName python:fieldName+':list';
        uids value;
        vlen python:len(vocab);
        refs python:here.getReferenceImpl(field.relationship)"
    class="fieldgroup"
    >

<!-- XXX: should make our own CSS to display border around AnalysisRequests -->
<fieldset>
<br/>

<tal:item
    define="item_tabindex tabindex/next;
        item_id string:${fieldName}_${item_tabindex}"
    repeat="ref refs">

<tal:analysisrequest define="
    obj ref/getTargetObject;
    a_url obj/absolute_url;
    a_typeinfo obj/getTypeInfo;
    obj_title_or_id obj/title_or_id;
    ">

<input type="checkbox" class="noborder" name="ids:list" id="#" value="#"
    tal:attributes="
        value obj/getId;
        id python: 'cb_'+obj.getId();
        checked request/ids_checked|nothing;
        tabindex tabindex/next|nothing; alt string:Select $obj_title_or_id;
        title string:Select $obj_title_or_id" />

<a  tal:attributes="href python:a_url+'/'+a_typeinfo.getActionById('edit')"
    tal:content="obj/Title">Pete Smith</a>
<br/>
<br/>

</tal:analysisrequest>

</tal:item>

<!--
XXX: copied from AT reference.pt - this can be simplified to
AnalysisRequests content type only
-->
<input
    type="hidden"
    name="associate_ref:list"
    value="fieldname"
    tal:attributes="value field/getName"/>
<input class="context"
    tabindex=""
    type="submit"
    value="Add"
    name="form.button.form_add"
    tal:define="cdestination python:utool.getRelativeContentURL(here);"
    tal:attributes="onclick string:this.form['add_reference.field:record'].value='${field/getName}';;this.form['add_reference.type:record'].value='AnalysisRequest';;this.form['add_reference.destination:record'].value='${cdestination}';
        id string:${field/getName}_link;
        tabindex tabindex/next;"
    i18n:attributes="value"
    />&nbsp;&nbsp;

<script tal:content="structure here/reference_focus_js"></script>

<input
    class="context"
    type="submit"
    value="Delete"
    tabindex=""
    i18n:attributes="value"
    tal:attributes="tabindex tabindex/next;
        onclick string:this.form.action='analysisrequest_delete';"
    tal:condition="refs"
    />

</fieldset>
</div>
</metal:use>
</metal:edit_macro>

<metal:search_macro define-macro="search">
<div metal:use-macro="here/widgets/reference/macros/edit"></div>
</metal:search_macro>

</body>
</html>

