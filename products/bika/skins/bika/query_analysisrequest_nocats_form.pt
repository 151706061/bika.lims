<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bika">

<head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border', 1)" />

    <metal:calendar fill-slot="javascript_head_slot">
        <!-- ECMAScript calendar -->
        <style type="text/css" media="all"
            tal:content="string:@import url($portal_url/jscalendar/calendar-system.css);"></style>
        <script type="text/javascript"
            tal:attributes="src string:$portal_url/jscalendar/calendar_stripped.js"></script>
        <script type="text/javascript" charset="iso-8859-1"
            tal:condition="exists: portal/jscalendar/calendar-en.js"
            tal:attributes="src string:$portal_url/jscalendar/calendar-en.js"></script>
    </metal:calendar>

</head>
             
             
<body>

<div metal:fill-slot="main"
    tal:define="
        req_client_uid python:request.get('ClientUID', None);
        req_contact_uid python:request.get('ContactUID', None);
        req_profile_uid python:request.get('ProfileUID', None);
        req_request_id python:request.get('RequestID', None);
        req_client_order python:request.get('ClientOrderNumber', None);
        req_client_ref python:request.get('ClientReference', None);
        req_client_sampleid python:request.get('ClientSampleID', None);
        req_sampletype python:request.get('SampleTypeUID', None);
        req_samplepoint python:request.get('SamplePointUID', None);
        req_review_state python:request.get('review_state', None);
        req_submitted_by python:request.get('SubmittedByUser', None);
        req_date_sampled_from python:request.get('DateSampled_fromdate', None);
        req_date_sampled_to python:request.get('DateSampled_todate', None);
        req_date_req_from python:request.get('DateRequested_fromdate', None);
        req_date_req_to python:request.get('DateRequested_todate', None);
        req_date_rec_from python:request.get('DateReceived_fromdate', None);
        req_date_rec_to python:request.get('DateReceived_todate', None);
        req_date_pub_from python:request.get('DatePublished_fromdate', None);
        req_date_pub_to python:request.get('DatePublished_todate', None);
    ">
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="bika_calendar_formfield.js"></script>
<h1>
<tal:block replace="structure python:getattr(here, here.getIcon(1))"/>
<span i18n:translate="heading_query_analysis_requests"
    >Query analysis requests</span>
</h1>

<form action="" method="post" name="search"
    tal:attributes="action template/getId">

<fieldset>
<legend i18n:translate="legend_search">Search</legend>

<div class="field" tal:condition="not:here/member_is_client">
    <label i18n:translate="label_client"
        >Client</label><br/>
    <select name="ClientUID:ignore_empty" 
            onChange="javascript:document.getElementById('send_ClientUID').value=document.getElementById('ClientUID').value"
            style=""
            id="ClientUID"
            tal:attributes="style string:font-family:${here/base_properties/fontFamily};;font-size:100%;">
        <option value=""/>

        <tal:clients
            define="    
                clients python:here.portal_catalog(portal_type='Client');
                sort_on python:(('Title', 'nocase', 'asc'),);
                clients python:sequence.sort(clients, sort_on);"
            repeat="client clients">
        <option value=""
            tal:define="client_uid python:client.UID"
            tal:attributes="value client_uid;
                selected python:req_client_uid == client_uid and 'selected' or ''"
            tal:content="client/Title"
            >ClientSystems</option>

        </tal:clients>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_contact"
        >Contact</label><br/>
    <select name="ContactUID:ignore_empty" 
            style=""
            id="ContactUID"
            onChange="javascript:document.getElementById('send_ContactUID').value=document.getElementById('ContactUID').value"
            tal:attributes="style string:font-family:${here/base_properties/fontFamily};;font-size:100%;">
        <option value=""/>

        <tal:contacts
            define="    
                contacts python:here.portal_catalog(portal_type='Contact');
                sort_on python:(('Title', 'nocase', 'asc'),);
                contacts python:sequence.sort(contacts, sort_on);"
            repeat="contact contacts">
        <option value=""
            tal:attributes="value contact/UID;
                selected python:req_contact_uid == contact.UID and 'selected' or ''"
            tal:content="contact/Title"
            >Upfront Systems</option>

        </tal:contacts>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_profile">Profile</label><br/>
    <select name="ProfileUID:ignore_empty" 
            style=""
            id="ProfileUID"
            onChange="javascript:document.getElementById('send_ProfileUID').value=document.getElementById('ProfileUID').value"
            tal:attributes="style string:font-family:${here/base_properties/fontFamily};;font-size:100%;">
        <option value=""/>

        <tal:clientprofiles condition="here/member_is_client">
        <tal:ploop1
            define="client python:here.portal_catalog(portal_type='Client');
                    clientUID python:client[0].UID;
                    profiles python:here.portal_catalog(portal_type='ARProfile', ClientUID = clientUID, sort_on='sortable_title');"
            repeat="profile profiles">
        <option value=""
            tal:attributes="value profile/UID;
                selected python:req_profile_uid == profile.UID and 'selected' or ''"
            tal:content="profile/Title"
            >pr01</option>
        </tal:ploop1>
        </tal:clientprofiles>

        <tal:allprofiles condition="not:here/member_is_client">
        <tal:ploop2
            define="profiles python:here.portal_catalog(portal_type='ARProfile', sort_on='sortable_title');"
            repeat="profile profiles">
        <option value=""
            tal:attributes="value profile/UID;
                selected python:req_profile_uid == profile.UID and 'selected' or ''"
            tal:content="profile/Title"
            >pr01</option>
        </tal:ploop2>
        </tal:allprofiles>

        <tal:labprofiles
            define="profiles python:here.portal_catalog(portal_type='LabARProfile', sort_on='sortable_title');"
            repeat="profile profiles">
        <option value=""
            tal:attributes="value profile/UID;
                selected python:req_profile_uid == profile.UID and 'selected' or ''"
            tal:content="python:'Lab:' + profile.Title"
            >Lab:pr01</option>
        </tal:labprofiles>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_requestid"
        >Request ID</label><br/>
    <input name="RequestID:ignore_empty"
        id="RequestID"
        onChange="javascript:document.getElementById('send_RequestID').value=document.getElementById('RequestID').value"
        tal:attributes="value req_request_id | nothing"/>
</div>

<div class="field">
    <label i18n:translate="label_client_order_id"
        >Client Order ID</label><br/>
    <input name="ClientOrderNumber:ignore_empty"
        id="ClientOrderNumber"
        onChange="javascript:document.getElementById('send_ClientOrderNumber').value=document.getElementById('ClientOrderNumber').value"
        tal:attributes="value req_client_order | nothing"/>
</div>

<div class="field">
    <label i18n:translate="label_clientreference"
        >Client Reference</label><br/>
    <input name="ClientReference:ignore_empty"
        id="ClientReference"
        onChange="javascript:document.getElementById('send_ClientReference').value=document.getElementById('ClientReference').value"
        tal:attributes="value request/ClientReference | nothing"/>
</div>

<div class="field">
    <label i18n:translate="label_clientsampleid"
        >Client Sample ID</label><br/>
    <input name="ClientSampleID:ignore_empty"
        id="ClientSampleID"
        onChange="javascript:document.getElementById('send_ClientSampleID').value=document.getElementById('ClientSampleID').value"
        tal:attributes="value request/ClientSampleID | nothing"/>
</div>

<div class="field">
    <label i18n:translate="label_sampletype"
        >Sample type</label><br/>
    <select name="SampleTypeUID:ignore_empty" 
            style=""
            id="SampleTypeUID"
            onChange="javascript:document.getElementById('send_SampleTypeUID').value=document.getElementById('SampleTypeUID').value"
            tal:attributes="style string:font-family:${here/base_properties/fontFamily};;font-size:100%;">
        <option value=""/>

        <tal:sampletypes
            define="    
                sampletypes python:here.portal_catalog(portal_type='SampleType');
                sort_on python:(('Title', 'nocase', 'asc'),);
                sampletypes python:sequence.sort(sampletypes, sort_on);"
            repeat="sampletype sampletypes">
        <option value=""
            tal:define="sampletype_uid python:sampletype.UID" 
            tal:attributes="value sampletype_uid;
                selected python:req_sampletype == sampletype_uid and 'selected' or ''"
            tal:content="sampletype/Title"
            >Sample type</option>

        </tal:sampletypes>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_samplepoint"
        >Sample point</label><br/>
    <select name="SamplePointUID:ignore_empty" 
            style=""
            id="SamplePointUID"
            onChange="javascript:document.getElementById('send_SamplePointUID').value=document.getElementById('SamplePointUID').value"
            tal:attributes="style string:font-family:${here/base_properties/fontFamily};;font-size:100%;">
        <option value=""/>

        <tal:samplepoints
            define="    
                samplepoints python:here.portal_catalog(portal_type='SamplePoint');
                sort_on python:(('Title', 'nocase', 'asc'),);
                samplepoints python:sequence.sort(samplepoints, sort_on);"
            repeat="samplepoint samplepoints">
        <option value=""
            tal:define="samplepoint_uid python:samplepoint.UID" 
            tal:attributes="value samplepoint_uid;
                selected python:req_samplepoint == samplepoint_uid and 'selected' or ''"
            tal:content="samplepoint/Title"
            >Sample point</option>

        </tal:samplepoints>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_datesampled"
        >Date sampled</label><br/>
    <span i18n:translate="label_from">From</span>

    <tal:define define="
        id string:DateSampled_fromdate;
        inputname id;
        copy_to string:send_;
        show_hm python:False;
        formname string:search;
        value request/DateSampled_fromdate | nothing;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>

    <span i18n:translate="label_to">to</span>

    <tal:define define="
        id string:DateSampled_todate;
        inputname id;
        copy_to string:send_;
        formname string:search;
        value request/DateSampled_todate | nothing;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>

</div>

<div class="field">
    <label i18n:translate="label_daterequested"
        >Date requested</label><br/>
    <span i18n:translate="label_from">From</span>

    <tal:define define="
        id string:DateRequested_fromdate;
        inputname id;
        copy_to string:send_;
        show_hm python:False;
        formname string:search;
        value request/DateRequested_fromdate | nothing;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>

    <span i18n:translate="label_to">to</span>

    <tal:define define="
        id string:DateRequested_todate;
        inputname id;
        copy_to string:send_;
        formname string:search;
        value request/DateRequested_todate | nothing;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>

</div>

<div class="field">
    <label i18n:translate="label_datereceived"
        >Date received</label><br/>
    <span i18n:translate="label_from">From</span>

    <tal:define define="
        id string:DateReceived_fromdate;
        inputname id;
        copy_to string:send_;
        show_hm python:False;
        formname string:search;
        value request/DateReceived_fromdate | nothing;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>

    <span i18n:translate="label_to">to</span>

    <tal:define define="
        id string:DateReceived_todate;
        inputname id;
        copy_to string:send_;
        formname string:search;
        value request/DateReceived_todate | nothing;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>
</div>

<div class="field">
    <label i18n:translate="label_datepublished"
        >Date published</label><br/>
    <span i18n:translate="label_from">From</span>

    <tal:define define="
        id string:DatePublished_fromdate;
        inputname id;
        copy_to string:send_;
        show_hm python:False;
        formname string:search;
        value request/DatePublished_fromdate | nothing;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>

    <span i18n:translate="label_to">to</span>

    <tal:define define="
        id string:DatePublished_todate;
        inputname id;
        copy_to string:send_;
        formname string:search;
        value request/DatePublished_todate | nothing;
        show_hm python:False;
        inputvalue python:test(value!='None', value, '');">
    <metal:use use-macro="here/bika_calendar_macros/macros/calendarDatePicker">
        a calendar, hopefully
    </metal:use>
    </tal:define>
</div>

<div class="field">
    <label i18n:translate="label_status"
        >Status</label><br/>
    <select name="review_state:ignore_empty" 
            style=""
            onChange="javascript:document.getElementById('send_review_state').value=document.getElementById('review_state').value"
            id="review_state">
        <option value=""/>
        <tal:states
            define="states here/analysis_workflow_states"
            tal:repeat="state states">
        <option value=""
            tal:attributes="value state/id;
                selected python:req_review_state == state['id'] and 'selected' or ''"
            tal:content="state/title"
            >Sample Received</option>
        </tal:states>
    </select>
</div>

<div class="field">
    <label i18n:translate="label_submitted_by"
        >Submitted by</label><br/>
    <select name="SubmittedByUser:ignore_empty" 
            style=""
            onChange="javascript:document.getElementById('send_submitted_by').value=document.getElementById('SubmittedByUser').value"
            id="SubmittedByUser"
            tal:attributes="style string:font-family:${here/base_properties/fontFamily};;font-size:100%;">
        <option value=""/>
    <tal:item 
        tal:define="vocab python:here.get_userlist()"
        tal:repeat="item vocab">
        <option value="" selected="selected"
            tal:define="userid python:item[0]; username python:item[1]"
            tal:attributes="value userid;
                selected python:userid == req_submitted_by  and 'selected' or ''"
            tal:content="username"
            >Joe Storm</option>
    </tal:item>
    </select>
</div>

</fieldset>
</form>

<form action="query_analysisrequest_results" method="post" name="search">
<input type="HIDDEN" name="getClientUID:ignore_empty" id="send_ClientUID" value=""
    tal:attributes="value req_client_uid"/>
<input type="HIDDEN" name="getContactUID:ignore_empty" id="send_ContactUID" value=""
    tal:attributes="value req_contact_uid"/>
<input type="HIDDEN" name="getProfileUID:ignore_empty" id="send_ProfileUID" value=""
    tal:attributes="value req_profile_uid"/>
<input type="HIDDEN" name="getRequestID:ignore_empty" id="send_RequestID" value=""
    tal:attributes="value req_request_id"/>
<input type="HIDDEN" name="getClientOrderNumber:ignore_empty" id="send_ClientOrderNumber" value=""
    tal:attributes="value req_client_order"/>
<input type="HIDDEN" name="ClientReference:ignore_empty" id="send_ClientReference" value=""
    tal:attributes="value req_client_ref"/>
<input type="HIDDEN" name="ClientSampleID:ignore_empty" id="send_ClientSampleID" value=""
    tal:attributes="value req_client_sampleid"/>
<input type="HIDDEN" name="SampleTypeUID:ignore_empty" id="send_SampleTypeUID" value=""
    tal:attributes="value req_sampletype"/>
<input type="HIDDEN" name="SamplePointUID:ignore_empty" id="send_SamplePointUID" value=""
    tal:attributes="value req_samplepoint"/>
<input type="HIDDEN" name="review_state:ignore_empty" id="send_review_state" value=""
    tal:attributes="value req_review_state"/>
<input type="HIDDEN" name="SubmittedByUser:ignore_empty" id="send_submitted_by" value=""
    tal:attributes="value req_submitted_by"/>
<input type="HIDDEN" name="DateSampled_fromdate:ignore_empty" id="send_DateSampled_fromdate" value=""
    tal:attributes="value req_date_sampled_from"/>
<input type="HIDDEN" name="DateSampled_todate:ignore_empty" id="send_DateSampled_todate" value=""
    tal:attributes="value req_date_sampled_to"/>
<input type="HIDDEN" name="getDateRequested_fromdate:ignore_empty" id="send_DateRequested_fromdate" value=""
    tal:attributes="value req_date_req_from"/>
<input type="HIDDEN" name="getDateRequested_todate:ignore_empty" id="send_DateRequested_todate" value=""
    tal:attributes="value req_date_req_to"/>
<input type="HIDDEN" name="getDateReceived_fromdate:ignore_empty" id="send_DateReceived_fromdate" value=""
    tal:attributes="value req_date_rec_from"/>
<input type="HIDDEN" name="getDateReceived_todate:ignore_empty" id="send_DateReceived_todate" value=""
    tal:attributes="value req_date_rec_to"/>
<input type="HIDDEN" name="getDatePublished_fromdate:ignore_empty" id="send_DatePublished_fromdate" value=""
    tal:attributes="value req_date_pub_from"/>
<input type="HIDDEN" name="getDatePublished_todate:ignore_empty" id="send_DatePublished_todate" value=""
    tal:attributes="value req_date_pub_to"/>
<div class="field">
    <input tabindex=""
        class="searchButton"
        type="submit"
        name="query_analysisrequest_results:method"
        value="Search"
        i18n:attributes="value"
        />                       
</div>

</form>

</div>

</body>
</html>
