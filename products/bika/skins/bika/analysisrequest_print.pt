<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<metal:block use-macro="here/global_defines/macros/defines" />

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      tal:attributes="lang default_language|default;
                      xml:lang default_language|default;"
      i18n:domain="bika">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"
          tal:define="charset site_properties/default_charset|string:utf-8"
          tal:attributes="content string:text/html;;charset=${charset}" />

    <!-- Column style sheet. -->
    <style type="text/css" media="all" tal:condition="exists: portal/ploneColumns.css"
           tal:content="string:@import url($portal_url/ploneColumns.css);">
    </style>

    <!-- Main style sheets for CSS2 capable browsers -->
    <style type="text/css" media="screen"
           tal:content="string: @import url($portal_url/plone.css);">
    </style>

    <!-- Old style sheet from Plone 1.0, remove tal:condition="nothing" if you need to use the old styles.
         Will be removed in Plone 2.1. -->
    <style type="text/css" media="screen"
           tal:condition="nothing"
           tal:content="string: @import url($portal_url/ploneDeprecated.css);">
    </style>

    <!-- Alternate style sheets for the bigger/smaller text switcher -->
    <link rel="alternate stylesheet" type="text/css" media="screen" href="" tal:attributes="href string:$portal_url/ploneTextSmall.css" title="Small Text" />
    <link rel="alternate stylesheet" type="text/css" media="screen" href="" tal:attributes="href string:$portal_url/ploneTextLarge.css" title="Large Text" />

    <!-- Custom style sheet if available -->
    <style type="text/css" media="all" tal:condition="exists: portal/ploneCustom.css"
           tal:content="string:@import url($portal_url/ploneCustom.css);">
    </style>

    <!-- Style sheet used for printing -->
    <link rel="stylesheet" type="text/css" media="print" href=""
          tal:attributes="href string:$portal_url/plonePrint.css" />

    <!-- Internet Explorer CSS Fixes -->
    <tal:iefixstart replace="structure string:&lt;!--[if IE]&gt;" />
    <style type="text/css" media="all" tal:condition="exists: portal/ploneIEFixes.css"
           tal:content="string:@import url($portal_url/ploneIEFixes.css);">
    </style>
    <tal:iefixend replace="structure string:&lt;![endif]--&gt;" />

</head>

<body>

<metal:block define-macro="publish">
<style>
body {
    font-family: Arial, "Lucida Grande", Verdana, Lucida, Helvetica, sans-serif;
    background-color: White;
    color: Black;
    margin: 1em;
    padding: 0;
}

a {
    text-decoration: none;
    color: #436976;
    background-color: transparent;
}
img {
    border: none;
    vertical-align: middle;
}
p {
    margin: 0.5em 0em 1em 0em;
    line-height: 1.5em;
}
p a {
    text-decoration: underline;
}
p a:visited {
    color: Purple;
    background-color: transparent;
}
p a:active {
    color: Red;
    background-color: transparent;
}
p img {
    border: 0;
    margin: 0;
}

hr {
    height: 1px;
    color: #d3d3ad;
    background-color: transparent;
}

h1, h2, h3, h4, h5, h6 {
    color: Black;
    background-color: transparent;
    font-family: Arial, "Lucida Grande", Verdana, Lucida, Helvetica, sans-serif;
    font-size: 69%;
    font-weight: normal;
    margin: 0;
    padding-top: 0.5em;
    border-bottom: 1px solid #636321;
}

h1 a,
h2 a,
h3 a,
h4 a,
h5 a,
h6 a {
    color: Black ! important; 
}

h1 {
    font-size: 160%;
}

h2 {
    font-size: 150%;
}

h3 {
    font-size: 140%;
    border-bottom: none;
    font-weight: bold;
}

h4 {
    font-size: 120%;
    border-bottom: none;
    font-weight: bold;
}

h5 {
    font-size: 100%;
    border-bottom: none;
    font-weight: bold;
}

h6 {
    font-size: 85%;
    border-bottom: none;
    font-weight: bold;
}
.documentDescription {
    font-weight: bold;
    display: block;
    margin: 1em 0em;
    line-height: 1.5em;
}
.documentByLine {
    text-align: left;
    font-size: 85%;
    clear: both;
    font-weight: normal;
    color: #76797c;
}
.documentByLine a {
    text-decoration: underline;
}
.eventDetail {
    font-style: italic;
}

.logos {
    width: 50%
}
.address {
    width: 100%
}

.analysisrequest {
    border-collapse: collapse;
    border-left: 1px solid #636321;
    border-bottom: 1px solid #636321;
    font-size: 85%;
    margin: 1em 0em 1em 0em;
}

.analysisrequest th {
    background: transparent;
    border-top: 1px solid #636321;
    border-right: 1px solid #636321;
    border-bottom: 1px solid #636321;
    font-weight: normal;
    padding: 0em 1em 0em 1em;
    text-align: left;
}
/* removed for BM
    background: #d3d3ad;
*/

.analysisrequest .odd {
    /*every second line should be shaded */
    background-color: transparent;
}

.analysisrequest .even {
    background-color: transparent;
}
/* removed for BM
    background-color: #f7f9fa;
*/

.analysisrequest .listingCheckbox {
    text-align: center;
}
.analysisrequest td.left {
    text-align: left;
}
.analysisrequest td {
    border-right: 1px solid #636321;
    border-top: 1px solid #636321;
    border-bottom: 1px solid #636321;
    padding: 0em 0em;
    vertical-align: top;
    text-align: center;
}
.analysisrequest a:hover {
    text-decoration: underline;
}
.analysisrequest img {
    vertical-align: middle;
}

.analysisrequest .amount {
    text-align: right;
    padding-right: 1em;
}
.analysisrequest .dryhead {
    background-color: transparent;
}
/* removed for BM
    background-color: #a6b5db;
*/

.analysisrequest .drybody {
    background-color: transparent;
}
/* removed for BM
    background-color: #dae0f0;
*/
.category  {
    text-align: left ! important;
    background-color: transparent;
}
.remarks {
    border-collapse: collapse;
    border-left: 1px solid #636321;
    border-bottom: 1px solid #636321;
    font-size: 85%;
    margin: 1em 0em 1em 0em;
}

.remarks th {
    background: transparent;
    border-top: 1px solid #636321;
    border-right: 1px solid #636321;
    font-weight: normal;
    padding: 0em 1em 0em 1em;
    text-align: left;
}
/* removed for BM 
    background: #d3d3ad;
*/

.remarks td {
    border-right: 1px solid #636321;
    border-top: 1px solid #636321;
    border-bottom: 1px solid #636321;
    padding: 0em 1em 0em 1em;
    vertical-align: top;
    text-align: left;
}
.remarks th.tabletitle {
    text-align: center;
}

.out_of_range {
    color: red;;
}
.in_error_range {
    color: red;;
}
.retested {
    color: red;;
    font-size: 80%;;
    font-weight: normal;
}
.discreeter {
    color: #76797c;;
    font-size: 80%;;
    font-weight: normal;
}

</style>
<body>

<tal:block define="
        laboratory python:options['laboratory'];
        lab_address python:laboratory.getPostalAddress();
        lab_address python:lab_address and lab_address or laboratory.getBillingAddress();
        lab_address python:lab_address and lab_address or laboratory.getPhysicalAddress();
        contact python:options['contact'];
        client python:contact.aq_parent;
        contact_address python:contact.getPostalAddress();
        contact_address python:contact_address and contact_address or contact.getBillingAddress();
        contact_address python:contact_address and contact_address or client.getPostalAddress();
        contact_address python:contact_address and contact_address or client.getBillingAddress();
        contact_address python:contact_address and contact_address or contact.getPhysicalAddress();
        contact_address python:contact_address and contact_address or client.getPhysicalAddress();
        lab_accredited laboratory/LaboratoryAccredited;
        batch python:options['analysis_requests'];
        service_info python:portal.get_services_from_requests(batch);
        services service_info/Services;
        any_accredited service_info/Accredited;
        global dry_matter service_info/DryMatter;
        accredited python:lab_accredited and any_accredited;
        global invoice_exclude python:0;
        global out_of_range python:0"
    i18n:domain="bika">
<table class="logos">
<tr><td>
                <img src="" tal:attributes="src string:${portal/absolute_url}/logo_print.jpg">
</td>
<td tal:condition="accredited">
        <img src="" tal:attributes="src string:${portal/absolute_url}/accreditation_print.jpg">
</td></tr>
</table>

<table class="address">
<tr>
<td>
<div tal:content="contact/getFullname"></div>
<div tal:content="client/Title"></div>
<div tal:define="address python:contact_address.get('address','')"
    tal:content="structure python:modules['Products.PythonScripts.standard'].newline_to_br(address)"> </div>
<div>
<span tal:content="python:contact_address.get('city','')"></span>,
<span tal:content="python:contact_address.get('state','')"></span>,
<span tal:content="python:contact_address.get('zip','')"></span>
<span tal:content="python:contact_address.get('country','')"></span>
</div>
</td>
<td>
<div tal:content="laboratory/Title"></div>
<div tal:define="address python:lab_address.get('address','')"
    tal:content="structure python:modules['Products.PythonScripts.standard'].newline_to_br(address)"> </div>
<div>
<span tal:content="python:lab_address.get('city','')"></span>,
<span tal:content="python:lab_address.get('state','')"></span>,
<span tal:content="python:lab_address.get('zip','')"></span>
<span tal:content="python:lab_address.get('country','')"></span>
</div>
</td>
</tr>
</table>

<table class="remarks">
<th class="tabletitle"
    colspan="2"
    i18n:translate="label_attachments">Attachments</th>
<tal:ar tal:repeat="ar batch">
<tr tal:define="attachments ar/getAttachment"
    tal:condition="attachments">

<th tal:content="string:${ar/getRequestID}:">AR:</th>
<td>
<tal:attachment tal:repeat="attachment attachments">
<div
    tal:define="file python:attachment.getAttachmentFile();
                filename file/filename | nothing;
                filesize file/get_size | python:file and len(file) or 0;
                icon file/getBestIcon | nothing">
<img tal:condition="icon" src=""
    tal:attributes="src string:${here/portal_url}/$icon"/>
<a href=""  title="Click to download"
    tal:attributes="href string:${attachment/absolute_url}/at_download/AttachmentFile"
    tal:content=filename>Filename</a>
<span class="discreet" tal:content="python:attachment.getAttachmentType().Title()">Filename</span>
<span class="discreet" tal:content="python:here.lookupMime(file.getContentType())">ContentType</span> &mdash;
<span class="discreet" tal:content="python:'%sKb' % (filesize / 1024)">0Kb</span>
</div>
</tal:attachment>
</td>
</tr>
<tal:analyses tal:repeat="analysis ar/getAnalyses">
<tal:attachments tal:define="attachments analysis/getAttachment">
<tal:attachment tal:repeat="attachment attachments">
<tr>

<th tal:content="string:${ar/getRequestID} - ${analysis/Title}:">AR:</th>
<td>
<div
    tal:define="file python:attachment.getAttachmentFile();
                filename file/filename | nothing;
                filesize file/get_size | python:file and len(file) or 0;
                icon file/getBestIcon | nothing">
<img tal:condition="icon" src=""
    tal:attributes="src string:${here/portal_url}/$icon"/>
<a href=""  title="Click to download"
    tal:attributes="href string:${attachment/absolute_url}/at_download/AttachmentFile"
    tal:content=filename>Filename</a>
<span class="discreet" tal:content="python:attachment.getAttachmentType().Title()">Filename</span>
<span class="discreet" tal:content="python:here.lookupMime(file.getContentType())">ContentType</span> &mdash;
<span class="discreet" tal:content="python:'%sKb' % (filesize / 1024)">0Kb</span>
</div>
</td></tr>
</tal:attachment>
</tal:attachments>
</tal:analyses>
</tal:ar>
</table>

<table
    class="analysisrequest"
    summary="analysis request listing"
    cellpadding="2" cellspacing="0">

<thead>
<tr>
<th i18n:translate="label_client_order_id" i18n:domain="bika">Client Order ID</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="ar/getClientOrderNumber">123</td>
</tr>
<tr>
<th i18n:translate="label_clientreference" i18n:domain="bika">Client Reference</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="python:ar.getSample().getClientReference()">R01</td>
</tr>

<tr>
<th i18n:translate="label_clientsampleid" i18n:domain="bika">Client Sample ID</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="python:ar.getSample().getClientSampleID()">S01</td>
</tr>
<tr>
<th i18n:translate="label_requestid" i18n:domain="bika">Request ID</th>
<td tal:repeat="ar batch" 
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1">
<a href="" tal:content="ar/getRequestID"
    tal:attributes="href ar/absolute_url">AR-00001</a>
<tal:exclude tal:condition="ar/getInvoiceExclude">
<img src="" 
    tal:define="global invoice_exclude python:1"
    tal:attributes="src string:${portal/absolute_url}/no_invoice.png">
</tal:exclude>
</td>
</tr>

<tr>
<th i18n:translate="label_sampleid" i18n:domain="bika">Sample ID</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1">
<a href="" 
    tal:define="sample ar/getSample"
    tal:content="sample/getSampleID"
    tal:attributes="href sample/absolute_url">S-00001</a>
</td>
</tr>

<tr>
<th i18n:translate="label_client" i18n:domain="bika">Client</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="ar/aq_parent/Title">Lab client</td>
</tr>

<tr>
<th i18n:translate="label_sampletype" i18n:domain="bika">Sample Type</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="python:ar.getSample().getSampleType().Title()">SampleType</td>
</tr>

<tr>
<th i18n:translate="label_samplepoint" i18n:domain="bika">Sample Point</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1">
<span
    tal:define="samplepoint python:ar.getSample().getSamplePoint()"
    tal:content="samplepoint/Title|nothing">SamplePoint</span></td>
</tr>

<tr>
<th i18n:translate="label_datesampled">Date sampled
</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1">
<tal:datesampled
    tal:define="sample ar/getSample;
               datesampled python:sample.getDateSampled() or None">
<span tal:condition="datesampled"
      tal:content="python:plone_view.toLocalizedTime(datesampled, long_format=1)"> </span>
</tal:datesampled>
</td>
</tr>

<tr>
<th i18n:translate="label_datereceived">Date received
</th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="python:plone_view.toLocalizedTime(ar.getDateReceived(), long_format=1)"
    >2005-01-01 10:00</td>
</tr>

<tr>
<th i18n:translate="label_datepublished">Date published </th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1"
    tal:content="python:plone_view.toLocalizedTime(ar.getDatePublished(), long_format=1)"
    >2005-01-01 10:00</td>
</tr>


<tr>
<th i18n:translate="label_verified_by">Verified by </th>
<td tal:repeat="ar batch"
    tal:attributes="colspan python:ar.getReportDryMatter() and 2 or 1">
<span
    tal:define="verifier python:here.get_analysisrequest_verifier(ar)"
    tal:content="verifier">
</span>
</td>
</tr>

<tr>
<th>
<b i18n:translate="label_analysis_results" i18n:domain="bika">
Analysis results</b>
</th>
<tal:results tal:repeat="ar batch">
<tal:drymatter tal:condition="ar/getReportDryMatter">
<th><b i18n:translate="label_as_fed">As Fed</b></th>
<th class="dryhead"><b i18n:translate="label_dry">Dry</b></th>
</tal:drymatter>
<tal:notdrymatter tal:condition="not:ar/getReportDryMatter">
<th></th>
</tal:notdrymatter>
</tal:results>
</tr>

</thead>

<tbody tal:define="global columns python:0">
<tal:arcount 
    tal:repeat="ar batch">
<tal:ar 
    tal:define="global columns python:ar.getReportDryMatter() and columns + 2 or columns + 1">
</tal:ar>
</tal:arcount>        
<tal:service
    tal:define="global category python:None"
    tal:repeat="service services">
<tr tal:condition="python:service.getCategoryName() != category">
<td class="category" 
        tal:attributes="colspan python:columns + 1"
    tal:define="global category service/getCategoryName"
    tal:content="service/getCategoryName"></td>
</tr>
<tr tal:define="service_unit service/getUnit|nothing">

<th nowrap> 
<span tal:content="service/Title">Alcohol</span>
<em tal:content="service_unit">ml</em>
<img src="" 
    tal:condition="python:dry_matter and service.getReportDryMatter()"
    tal:attributes="src string:${portal/absolute_url}/dry.png">
<img src="" 
    tal:condition="python:accredited and service.getAccredited()"
    tal:attributes="src string:${portal/absolute_url}/accredited.png">
</th>

<tal:ars repeat="ar batch">
<div tal:define="
            service_id service/getId;
            analyses python:portal.group_analyses_by_service(ar.getPublishedAnalyses());
            analysis python:analyses.get(service_id, None);
            analysis_found python:analyses.has_key(service_id);
            result analysis/getResult|nothing;
            mou analysis/getUncertainty|nothing">
<tal:result
    tal:condition="analysis_found"
    tal:define="
        sampletype python:ar.getSample().getSampleType();
        sampletype_uid sampletype/UID;
        client_uid ar/aq_parent/UID;
        result_class python:analysis_found and portal.result_in_range(analysis, sampletype_uid, 'client') or '';
        global out_of_range python:result_class == 'out_of_range' and 1 or out_of_range">
<td nowrap align="center"
    tal:attributes="class result_class">
<span tal:content="result">10.00</span>
<img tal:condition="python:result_class == 'out_of_range'"
    src="" tal:attributes="src string:${portal/absolute_url}/exclamation.png">
<span tal:content="string:(${analysis/getUnit})"
      tal:condition="python:analysis.getUnit() != service_unit"/>
<span tal:content="string:(+/- $mou)"
      tal:condition="mou"/>
<div class="retested"
      tal:condition="analysis/getRetested"
      i18n:translate="retested">retested</div>
</td>
<td class="drybody" tal:condition="ar/getReportDryMatter">
<span tal:condition="analysis/getResultDM"
    tal:content="analysis/getResultDM">10</span>
</td>
</tal:result>
<tal:notanalysis tal:condition="python:not analysis">
<td></td>
<td class="drybody" tal:condition="ar/getReportDryMatter"></td>
</tal:notanalysis>
</div>
</tal:ars>
</tr>
</tal:service>

</tbody>

</table>

<table class="remarks">
<th class="tabletitle"
    colspan="2"
    i18n:translate="label_remarks">Remarks</th>
<tr tal:repeat="ar batch">
<th tal:content="string:${ar/getRequestID}:">AR:</th>
<td width=50%
    tal:content="python:ar.getNotes() or default">None</td>
</tr>
</table>
<br>
<div tal:repeat="manager mngr_ids"
    tal:define="mngr_info python:here.get_managers_from_requests(batch);
                mngr_ids python:mngr_info['ids'];
                managers python:mngr_info['dict']">
<tal:mngr
    tal:define="email python:managers[manager]['email'];
                phone python:managers[manager]['phone']">

<img src="" 
    tal:condition="signature"
    tal:define="signature python:managers[manager]['signature']"
    tal:attributes="src string:${signature}">
<br>
<span tal:content="python:managers[manager]['name']">Joe Blogs</span>
<span tal:condition="phone">&nbsp&nbsp</span>
<img src="" 
    tal:condition="phone"
    tal:attributes="src string:${portal/absolute_url}/telephone.jpg">
<span tal:content="phone">011 555 1112</span>
<span tal:condition="email">&nbsp&nbsp</span>
<img src="" 
    tal:condition="email"
    tal:attributes="src string:${portal/absolute_url}/email.jpg">
<a  tal:attributes="href string:mailto:${email}"
    tal:content="email">a@b.com</a>
</tal:mngr>
</div>
<p tal:replace="options/laboratory/Title"/>

<hr/>

<div class="discreeter"
    tal:define="global seq_no python:0">
<p tal:condition="out_of_range">
<img src="" tal:attributes="src string:${portal/absolute_url}/exclamation.png">
<span i18n:translate="legend_out_of_rangex">
        Result out of <tal:block replace="string:client" i18n:name="spec"/> specified range
</span>
</p>

<p tal:condition="dry_matter">
<img src="" tal:attributes="src string:${portal/absolute_url}/dry.png">
<span i18n:translate="disclaimer_dry">
Reported as dry matter</span>
</p>

<p tal:condition="invoice_exclude">
<img src="" tal:attributes="src string:${portal/absolute_url}/no_invoice.png">
<span i18n:translate="disclaimer_invoice_exclude">
Not invoiced</span>
</p>

<p tal:condition="lab_accredited">
<img src="" tal:attributes="src string:${portal/absolute_url}/accredited.png">
<span i18n:translate="disclaimer_accred">
Methods included in the <tal:block replace="options/laboratory/AccreditationBody" i18n:name="accreditation_body"/> schedule of Accreditation for this Laboratory. Analysis remarks are not accredited</span>
</p>

<p>
<span tal:define="global seq_no python:seq_no + 1"
    tal:content="string:$seq_no.">1</span>
<span i18n:translate="disclaimer_results_samples_tested">
Analysis results relate only to the samples tested</span></p>

<p tal:define="confidence_level options/laboratory/Confidence|nothing"
    tal:condition="confidence_level">
<span tal:define="global seq_no python:seq_no + 1"
    tal:content="string:$seq_no.">1</span>
<span i18n:translate="disclaimer_confidence_level">
    
Test results are at a <tal:block replace="confidence_level" i18n:name="lab_confidence"/>% confidence level</span></p>


<p>
<span tal:define="global seq_no python:seq_no + 1"
    tal:content="string:$seq_no.">1</span>
<span i18n:translate="disclaimer_no_reproduce">
This document shall not be reproduced except in full, without the written approval of <tal:block replace="options/laboratory/Title" i18n:name="name_lab"/></span></p>

</div>

<hr/>

</tal:block>

</metal:block>

</body>

</html>
