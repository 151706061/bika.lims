<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bika">

<head><title></title></head>

<body>
<div metal:fill-slot="main"
    tal:define="
        labproducts python:[p.getObject() for p in here.portal_catalog(portal_type='LabProduct')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        labproducts python:sequence.sort(labproducts, sort_on);
        errors options/state/getErrors">

<script type="text/javascript" src="utils.js"></script>

<tal:error repeat="error python:errors.keys()">
<tal:x define="message python:errors[error]">
<p class="portalMessage">
<span tal:content="error">field</span>:
<span tal:content="message">Error</span> </p>
</tal:x>
</tal:error>

<div metal:use-macro="here/document_actions/macros/document_actions">
    Document actions (print, sendto etc)
</div>

<h1>
    <img src="order.png" tal:attributes="src python:here.portal_types.getTypeInfo('Order').getIcon()"/>
    <span tal:omit-tag="" i18n:translate="heading_add_order"
        >Add Order</span>
</h1>

<form name="order_form" method="POST" action="template/getId"
    tal:attributes="action template/getId" autocomplete="off">

<input type="hidden" name="form.submitted" value="1" />
<input type="hidden" name="came_from" value="add" />

<br/>

<table
    summary="Order form"
    class="analysisrequest"
    cellpadding="0" cellspacing="0">
<thead>

<tr>
<th i18n:translate="label_orderdate">Order date</th>
<tal:orderdate
    tal:define="orderdate python:request.get('OrderDate')">
<td class="left" colspan="6"
    tal:content="python:plone_view.toLocalizedTime(orderdate, long_format=1)"
    >2005-01-01 10:00</td>
<input type="hidden" name="OrderDate"
    tal:attributes="value orderdate"/>
</tal:orderdate>
</tr>

<tr>
<th i18n:translate="label_contact_person">Contact person</th>
<td class="left" colspan="6">
    <select name="Contact" 
        tal:attributes="tabindex tabindex/next;">

    <tal:item 
        tal:define="
            vocab here/getContactsDisplayList;
            contact python:request.get('Contact');
            uid python:contact and contact.UID() or ''"
        tal:repeat="item vocab">
    <option selected="selected"
        tal:define="no_ref python:item == '';"
        tal:attributes="value item;
            selected python:test((item == uid) or no_ref, 'selected', '')"
        tal:content="python:here.translate(vocab.getMsgId(item), default=vocab.getValue(item))"></option>
    </tal:item>

    </select>
</td>
</tr>

<tr>
<th i18n:translate="label_product">Product</th>
<th i18n:translate="label_description">Description</th>
<th i18n:translate="label_volume">Volume</th>
<th i18n:translate="label_unit">Unit</th>
<th i18n:translate="label_price">Price</th>
<th i18n:translate="label_quantity">Quantity</th>
<th i18n:translate="label_total">Total</th>
</tr>

</thead>
<tbody>
<tal:labproduct repeat="labproduct labproducts">
<tr tal:define="price labproduct/getPrice">
<td class="left" tal:content="structure labproduct/Title">Bottle</td>
<td class="left" tal:content="structure labproduct/getProductDescription">Glass bottle</td>
<td class="left" tal:content="labproduct/getVolume">187 ml</td>
<td class="left" tal:content="labproduct/getUnit">187 ml</td>
<td class="amount" tal:content="price">10.00</td>
<td><input size="5" class="amount" name="labproducts" onchange="CalcTotal()"
    tal:define="
        product_id labproduct/getId;
        orderitem python:getattr(here, product_id, None);
        qty orderitem/getQuantity | nothing"
    tal:attributes="
        id product_id;
        name string:labproducts.${labproduct/UID}:record:ignore_empty;
        price labproduct/getPrice;
        totalprice labproduct/getTotalPrice;
        tabindex tabindex/next;
        value python:qty or '0'"
    tal:condition="price"/>
</td>
<td>
<input class="calculated" size="8" value="0.00" id="" disabled="disabled"
    tal:attributes="id string:${labproduct/getId}_total"
    tal:condition="price"/>
</td>
</tr>
</tal:labproduct>

</tbody>
<tfoot>

<tr>
<th colspan="5" i18n:translate="label_subtotal"><b>Subtotal</b></th>
<td>
<input class="amount" size="5" value="0.00" id="Qty" disabled="disabled"/>
</td>
<td>
<input class="amount" size="8" value="0.00" id="Subtotal" disabled="disabled"/>
</td>
</tr>

<tr>
<th colspan="6"  i18n:translate="label_vat"><b>VAT</b></th>
<td>
<input class="amount" size="8" value="0.00" id="VAT" disabled="disabled"/>
</td>
</tr>

<tr>
<th colspan="6"  i18n:translate="label_total"><b>Total</b></th>
<td>
<input class="amount" size="8" value="0.00" id="Total" disabled="disabled"/>
</td>
</tr>

</tfoot>
</table>

<br/>
<input class="context"
        tabindex=""
        type="submit"
        name="form_submit"
        value="Save"
        i18n:attributes="value"
        tal:attributes="tabindex tabindex/next"
        />
<input class="standalone"
        tabindex=""
        type="submit"
        name="form.button.cancel"
        value="Cancel"
        i18n:attributes="value"
        tal:attributes="tabindex tabindex/next"
        />



</form>
</div>

</body>

</html>


