<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="bika">

<head>
<title></title></head>
    <metal:calendar fill-slot="javascript_head_slot">
        <!-- ECMAScript calendar -->
        <style type="text/css" media="all"
            tal:content="string:@import url($portal_url/jscalendar/calendar-system.css);"></style>
        <script type="text/javascript"
            tal:attributes="src string:$portal_url/jscalendar/calendar_stripped.js"></script>
        <script type="text/javascript" charset="iso-8859-1"
            tal:condition="exists: portal/jscalendar/calendar-en.js"
            tal:attributes="src string:$portal_url/jscalendar/calendar-en.js"></script>
    </metal:calendar>
<body>
<div metal:fill-slot="prefs_configlet_main"
    tal:define="
        services python:[p.getObject() for p in here.portal_catalog(portal_type='AnalysisService')];
        sort_on python:(('Title', 'nocase', 'asc'),);
        services python:sequence.sort(services, sort_on);
        curr_results python:here.getResultsRangeDict();
        curr_analyses python:curr_results.keys();
        prev_analyses request/Service | python: [];
        analyses python:test(prev_analyses, prev_analyses, curr_analyses);
        errors options/state/getErrors">

<script type="text/javascript" src="utils.js"></script>
<tal:error repeat="error python:errors.keys()">
<tal:x define="message python:errors[error]">
<p class="portalMessage">
<span tal:content="error">field</span>:
<span tal:content="message">Error</span> </p>
</tal:x>
</tal:error>
<h1>
    <img src="standardstock.png" tal:attributes="src python:here.portal_types.getTypeInfo('StandardStock').getIcon()"/>
    <span tal:omit-tag="" i18n:translate="heading_standardstock_edit"
        >Standard stock</span>
</h1>

<div metal:use-macro="here/document_actions/macros/document_actions">
    Document actions (print, sendto etc)
</div>

<form name="edit_form"
    method="post"
    enctype="multipart/form-data"
    action=""
    tal:attributes="action python:here.absolute_url()+'/'+template.id"
    autocomplete="off">

<input type="hidden" name="form.submitted" value="1" />
<input type="hidden" name="StandardStockUID" value=""
    tal:attributes="value here/UID"/>

<br/>

<div class="field">
<label i18n:translate="label_title">Title</label>
    &nbsp;<span class="fieldRequired">(Required)</span>
<br/>
<input type="text" size="30" name="Title" value=""
    tal:attributes="value request/Title | here/Title"/>
</div>
<br/>
<div class="field">
<label i18n:translate="label_description">Description</label><br/>
<textarea rows="5" name="Description"
          cols="40" id="Description"
    tal:content="request/Description | here/StandardStockDescription">
</textarea>
</div>
<br>

<div class="field">
<label i18n:translate="label_creationdate">Date Created</label><br/>
<tal:define define="
    id string:DateCreated;
    inputname id;
    formname string:search;
    value request/DateCreated | here/getDateCreated;
    inputvalue python:test(value!='None', value, '');
    show_hm python:False">
<metal:use use-macro="here/calendar_macros/macros/calendarDatePickerBox">
    a calendar, hopefully
</metal:use>
</tal:define>
</div>
<br>

<div class="field">
<label i18n:translate="label_expirydate">Expiry Date</label><br/>
<tal:define define="
    id string:ExpiryDate;
    inputname id;
    formname string:search;
    value request/ExpiryDate | here/getExpiryDate;
    inputvalue python:test(value!='None', value, '');
    show_hm python:False">
<metal:use use-macro="here/calendar_macros/macros/calendarDatePickerBox">
    a calendar, hopefully
</metal:use>
</tal:define>
</div>
<br/>

<div class="field">
<input class="noborder" type="checkbox" name="Hazardous_visible" 
       value="on" id="Hazardous"
       onClick="toggleBoolean('Hazardous', 'Hazardous_hidden'); return true"
       tal:attributes="checked request/Hazardous | here/getHazardous"/>
<label i18n:translate="label_hazardous">Hazardous</label>
<input type="hidden" name="Hazardous"
       value="" id="Hazardous_hidden"
       tal:attributes="value request/Hazardous | here/getHazardous"/>
</div>
<br/>

<label i18n:translate="label_analyses">Analyses</label>
    &nbsp;<span class="fieldRequired">(Required)</span>
<table
    summary="Standard stock form"
    class="analysisrequest"
    cellpadding="0" cellspacing="0">

<tr>
<th colspan="2">
<b i18n:translate="label_analysis">Analysis</b>
</th>
<th>
<b align="center" i18n:translate="label_result">Result</b>
</th>
<th>
<b align="center" i18n:translate="label_error">% error</b>
</th>
<th>
<b align="center" i18n:translate="label_min">min</b>
</th>
<th>
<b align="center" i18n:translate="label_max">max</b>
</th>
</tr>
<tal:services tal:repeat="service services">
<tr tal:condition="python:service.getCalcType() != 'dep'">
<tal:service
    tal:define="unit service/getUnit;
                service_uid service/UID;
                analysis_found python:service_uid in analyses">
<th> 
<a tal:content="service/Title"
   tal:attributes="href service/absolute_url">
Alcohol
</a>

<em tal:condition="python:unit">(<span tal:replace="unit">mg/l</span>)</em>
</th>
<td>
<input type="checkbox" name="Service:list"
    class="noborder"
    tal:define="input_id string:${service_uid};
                checked python:analysis_found"
    tal:attributes="
        id input_id;
        onClick string:toggleResults('${service_uid}');
        value python:service_uid;
        checked checked"/>
</td>
<td>
<input size="6" name="" 
    tal:define="
        input_name string:stock.${service_uid}.result;
        style python:analysis_found and 'visibility:visible' or 'visibility:hidden';
        result python:service_uid in curr_analyses and test(curr_results[service_uid].has_key('result'),curr_results[service_uid]['result'],'') or ''"
    tal:attributes="
        style style;
        id string:${service_uid}.result;
        name string:${input_name}:ignore_empty:record;
        onChange string:calcMinMax('${service_uid}');
        value python:request.get(input_name, result)"/>
</td>
<td>
<input size="6" name=""
    tal:define="
        style python:analysis_found and 'visibility:visible' or 'visibility:hidden';
        input_name string:stock.${service_uid}.error;
        error python:None"
    tal:attributes="
        style style;
        id string:${service_uid}.error;
        name string:${input_name}:ignore_empty:record;
        onChange string:calcMinMax('${service_uid}');
        value python:request.get(input_name, error)"/>
</td>
<td>
<input size="6" name="" 
    tal:define="
        style python:analysis_found and 'visibility:visible' or 'visibility:hidden';
        input_name string:stock.${service_uid}.min;
        min python:service_uid in curr_analyses and test(curr_results[service_uid].has_key('min'), curr_results[service_uid]['min'], '') or ''"
    tal:attributes="
        style style;
        id string:${service_uid}.min;
        name string:${input_name}:ignore_empty:record;
        onChange string:clearError('${service_uid}');
        value python:request.get(input_name, min)"/>
</td>
<td>
<input size="6" name=""
    tal:define="
        style python:analysis_found and 'visibility:visible' or 'visibility:hidden';
        input_name string:stock.${service_uid}.max;
        max python:service_uid in curr_analyses and test(curr_results[service_uid].has_key('max'), curr_results[service_uid]['max'], '') or ''"
    tal:attributes="
        style style;
        id string:${service_uid}.max;
        onChange string:clearError('${service_uid}');
        name string:${input_name}:ignore_empty:record;
        value python:request.get(input_name, max)"/>
</td>
</tal:service>
</tr>
</tal:services>


</table>

<br/>
<input class="context"
        type="submit"
        name="form.button.submit"
        value="Save"
        i18n:attributes="value"
        />
<input class="standalone"
        type="submit"
        name="form.button.cancel"
        value="Cancel"
        i18n:attributes="value"
        />

</form>

</div>

</body>

</html>


