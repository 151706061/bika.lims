<metal:block define-macro="body">
<script type="text/javascript">
<!--
// function to open the popup window
function open_contact_browser(path)
{
    window.open(path + '/select_contact','select_contact','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,height=550');                 
}
//-->

// function to return a reference from the popup window back into the widget
function select_contact(uid, label)
{
    element=document.getElementById('Contact_uid')
    label_element=document.getElementById('Contact_label')
    element.value=uid
    label_element.value=label
}

</script>

<form action="email_query_result" method="post"
    tal:define="checkPermission python: here.portal_membership.checkPermission;"
    tal:attributes="action form_action|string:email_query_result">
<fieldset>
    <legend tal:content="form_legend|string:Email query results"
        >Email query results</legend>
    <div class="field">
    <label i18n:domain="bika" i18n:translate="label_search_contact">Search for contact</label><br/>

    <input id="Contact_label" name="Contact_label" size="40">
    <input id="Contact_uid" type="hidden" name="Contact_uid">
    <input type="hidden" name="mail_template"
        tal:attributes="value mail_template">
    <input type="hidden" name="date_index"
        tal:attributes="value date_index|nothing">

    <input type="hidden" name="query_client"
        tal:attributes="value query_client|nothing">
    <input type="hidden" name="query_contact"
        tal:attributes="value query_contact|nothing">

    <tal:x repeat="item request/form/items">
        <input type="hidden" name=""
            tal:attributes="name python:item[0]; value python:item[1]">
    </tal:x>

    <input type="button" class="searchButton" value="Browse..." 
        onClick="" i18n:attributes="value" i18n:domain="bika"
        tal:define="startup_directory here/get_contact_browser_startup_directory"
        tal:attributes="onClick string:javascript:open_contact_browser('${startup_directory}','Contact_uid')" />
    </div>
    <span i18n:domain="bika" i18n:translate="label_or">or</span>
    <div class="field">
    <label i18n:domain="bika" i18n:translate="label_enter_emailaddress"
        >Enter email address</label><br/>
    <input id="Contact_label" name="Contact_email_address:ignore_empty"
        size="40">
    </div>

    <input class="standalone" type="submit" value="Send mail" i18n:domain="bika" i18n:attributes="value">
</fieldset>
</form>
</metal:block>
