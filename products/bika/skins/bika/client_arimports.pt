<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bika">

<head>

<metal:block fill-slot="top_slot">
<span
    tal:replace="nothing"
    tal:define="dummy python:request.set('enable_border', 1)"
    />
</metal:block>

</head>
             
             
<body>

<div metal:fill-slot="main"
tal:define="
    dummy_a python:request.set('portal_type', 'ARImport');
    dummy_b python:request.set('getClientUID', here.UID());
    dummy_c python:request.set('sort_on', 'getDateImported');
    dummy_d python:request.set('sort_order', 'reverse');
    dummy_e python:here.toggle_state('arimport_review_state', 'all');
    arimport_state python:request.get('arimport_review_state',);
    dummy_f python:here.REQUEST.set('review_state', arimport_state);
    states python:here.get_toggles('arimport');
    header_state python:here.get_toggle_title(arimport_state, states)">

<div metal:use-macro="here/document_actions/macros/document_actions">
Document actions (print, sendto etc)
</div>

<h1>
<img src="arimport.png" tal:attributes="src python:here.portal_types.getTypeInfo('ARImport').getIcon()"/>
<span i18n:translate="heading_ar_imports">Analysis request imports</span>
<tal:not_all tal:condition="python:arimport_state != 'all'">
-
<span i18n:translate="" tal:content="header_state">All</span>
</tal:not_all>
</h1>

<div id="content-arimports"
     tal:define="
        all python:arimport_state == 'all';
        results python:test(all, here.portal_catalog(
                    portal_type='ARImport',
                    getClientUID=here.UID(),
                    sort_on='getDateImported',
                    sort_order='reverse'), 
                    container.queryCatalog());
        Batch python:modules['Products.CMFPlone'].Batch;
        b_start python:request.get('b_start',0);
        batch python:Batch(results, 15, int(b_start), orphan=1);
        
        manage_ars python:mtool.checkPermission('BIKA: Manage AnalysisRequest', here);
        buttons actions/folder_buttons;
        allowed python:manage_ars or arimport_state in ('imported', 'exported');
        global ar_action python:False">
<form name="add_arimports" action="." method="post">

<input
    class="standalone"
    type="submit"
    name="arimport_add_form:method"
    value="Import Analysis Requests"
    tabindex=""
    i18n:attributes="value"
    tal:attributes="
        tabindex tabindex/next|nothing"/>
</form>

<br/>
<form name="filter_result" action="" method="post"
    tal:attributes="action template/getId">
<input type="hidden" name="portal_type" value="ARImport"/>
<input type="hidden" name="getClientUID" value=""
    tal:attributes="value here/UID"/>
<input type="hidden" name="sort_on" value="getOrderID"/>
<input type="hidden" name="sort_order" value="reverse"/>

<div class="optionsToggle">
    <tal:x repeat="state states">
    <input class="noborder" type="radio" name="arimport_review_state" value="imported"
        onclick="this.form.submit()"
        tal:define="state_id state/id"
        tal:attributes="value state_id;
            checked python:request.get('arimport_review_state') == state_id and 'checked' or None"/>
     <span tal:content="state/title"  i18n:translate="">Imported</span>
    </tal:x>
</div>
</form>




<tal:button_conditions
    tal:condition="python:allowed and batch"
    tal:repeat="button actions/folder_buttons|nothing">
<tal:check_for_action
    tal:condition="python:button['id'] == 'delete'">
<tal:action_found
    tal:define="global ar_action python:True">
</tal:action_found>
</tal:check_for_action>
</tal:button_conditions>

<form name="arimports" action="." method="post">

<br/>

<table tal:condition="batch"
    class="listing"
    summary="analysis request import listing"
    cellpadding="0" cellspacing="0">

<thead>
<tr>
<th class="nosort" tal:condition="ar_action"><input
    class="noborder"
    type="checkbox"
    src="select_all_icon.gif"
    name="selectButton"
    title="Select all items"
    onClick="toggleSelect(this);"
    tal:attributes="src string:$portal_url/select_all_icon.gif"
    alt="Select all items"
    i18n:attributes="title; alt"
    />
</th>
<th i18n:translate="label_import">Import</th>
<!-- removed for bm
<th i18n:translate="label_ordernumber">Order number</th>
<th i18n:translate="label_quote">Quote</th>
<th i18n:translate="label_samplepoint">Sample Point</th>
-->
<th i18n:translate="label_dateimported">Date imported</th>
<th i18n:translate="label_validity"
    tal:condition="python:arimport_state != 'submitted'">Validity</th>
<th i18n:translate="label_datesubmitted"
    tal:condition="python:arimport_state != 'imported'">Date submitted</th>
<th i18n:translate="label_status"
    tal:condition="python:arimport_state == 'all'">Status</th>
</tr>
</thead>

<tbody tal:define="getRelativeContentURL nocall:utool/getRelativeContentURL">

<metal:block tal:repeat="item batch">
<tr tal:define="
        oddrow repeat/item/odd;
        obj item/getObject;
        item_title_or_id obj/title_or_id;
        import_state python:test(arimport_state == 'all',
            wtool.getInfoFor(obj, 'review_state', ''),
            arimport_state)"
    tal:attributes="
        class python:test(oddrow, 'even', 'odd')" >
<td tal:condition="ar_action">
<input type="checkbox" class="noborder" name="ids:list" id="#" value="#"
    tal:attributes="
        value obj/getId;
        id python: 'cb_'+obj.getId();
        checked request/ids_checked|nothing;
        tabindex tabindex/next|nothing;
        alt string:Select $item_title_or_id;
        title string:Select $item_title_or_id"/>
<input type="hidden" name="obj_paths:list" value="#"
    tal:attributes="value python:getRelativeContentURL(obj)" />
</td>
<!--
<td>
<a href="" 
    tal:attributes="href obj/absolute_url"
    tal:content="obj/getFileName">arimport.csv</a>
</td>
-->
<td>
<a href="" 
    tal:attributes="href obj/absolute_url"
    tal:content="item_title_or_id">B-01</a>
</td>
<!-- removed for bm
<td tal:content="obj/getOrderID">123</td>
<td tal:content="obj/getQuoteID">123</td>
<td tal:content="obj/getSamplePoint">CTProcessing</td>
-->
<td tal:content="python:plone_view.toLocalizedTime(obj.getDateImported(), long_format=1)"
    >2005-01-01 10:10</td>
<td tal:condition="python:arimport_state != 'submitted'"
    tal:define="status python:obj.getStatus() and 'Valid' or 'Invalid'"
    tal:content="status">Valid</td>
<td tal:condition="python:arimport_state != 'imported'">
<span tal:condition="python:import_state == 'submitted'"
    tal:content="python:plone_view.toLocalizedTime(obj.getDateApplied(), long_format=1)"
    >2005-01-01 10:10</span></td>
<td tal:condition="python:arimport_state == 'all'"
    tal:content="import_state">imported</td>
</tr>
</metal:block>

</tbody>

</table>


<!-- Navigation -->
<div metal:use-macro="here/batch_macros/macros/navigation" />

<tal:buttons tal:repeat="button actions/folder_buttons|nothing">
<input
    class="context"
    type="submit"
    name=""
    value=""
    tabindex=""
    tal:condition="python:batch and button['id'] == 'delete'"
    i18n:attributes="value"
    tal:attributes="
        value button/name;
        name button/url;
        tabindex tabindex/next" />
</tal:buttons>

</form>

</div>
</div>

</body>
</html>
