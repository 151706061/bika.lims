<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="bika">

<head><title></title></head>

<body>

<div metal:fill-slot="main"
    tal:define="errors options/state/getErrors;
                contact_has_user here/hasUser">

<h1 i18n:translate="heading_lims_access">Login details</h1>

<p i18n:translate="help_contact_has_user"
    tal:condition="contact_has_user">
    <span tal:content="here/getFullname" i18n:name="label_help_contact_fullname">Pete
    Smith</span> can log into the LIMS by using 
    <strong tal:content="here/getUsername"  i18n:name="label_help_contact_username">username</strong> as
    username. Contacts must change their own passwords. If a password is
    forgotten a contact can request a new password from the login form.
</p>

<form action=""
    method="post"
    tal:define="allowEnterPassword site_properties/validate_email|nothing;"
    tal:attributes="action template/getId"
    tal:condition="not:contact_has_user">

<div class="portalMessage" i18n:translate="help_contact_needs_user">No
    user exists for <span tal:content="here/getFullname" i18n:name="label_help_contact_fullname">Pete
    Smith</span> and he/she will not be able to log in. Fill in the form
    below to create one for him/her.
</div>


<fieldset>

<input
    type="hidden"
    name="fullname"
    value="fullname"
    tal:attributes="value here/getFullname" 
    />

<div class="field"
    tal:define="error errors/username| nothing;
                username request/username | nothing"
    tal:attributes="class python:test(error, 'field error', 'field')">

<label i18n:translate="label_user_name">User Name</label>

<span class="fieldRequired" title="Required"
        i18n:attributes="title"
        i18n:translate="label_required">(Required)</span>

        <div i18n:translate="help_user_name_creation_casesensitive"
            class="formHelp">
        Enter a user name, usually something like
        'jsmith'. No spaces or special characters.
        Usernames and passwords are case sensitive,
        make sure the caps lock key is not enabled.
        This is the name used to log in.
        </div>

        <div tal:content="error">Validation error output</div>

        <input type="text"
                name="username"
                size="30"
                value="username"
                tabindex=""
                tal:attributes="value username;
                                tabindex tabindex/next;"
                />

</div>


<div class="field"
    tal:condition="not: allowEnterPassword"
    tal:define="error errors/password | nothing;
                password request/password | nothing;"
    tal:attributes="class python:test(error, 'field error', 'field')">

<label i18n:translate="label_password">Password</label>

<span class="fieldRequired" title="Required"
        i18n:attributes="title"
        i18n:translate="label_required">(Required)</span>

        <div class="formHelp" i18n:translate="help_password_creation">
        Minimum 5 characters.
        </div>

        <div tal:content="error">Validation error output</div>

        <input type="password"
                name="password"
                size="10"
                value=""
                tabindex=""
                tal:attributes="value password;
                                tabindex tabindex/next;"
                />
</div>

<div class="field"
    tal:condition="not: allowEnterPassword"
    tal:define="error errors/confirm | nothing;
                confirm request/confirm | nothing;"
    tal:attributes="class python:test(error, 'field error', 'field')">


<label i18n:translate="label_confirm_password">Confirm password</label>

<span class="fieldRequired" title="Required"
        i18n:attributes="title"
        i18n:translate="label_required">(Required)</span>

        <div class="formHelp" i18n:translate="help_confirm_password">
        Re-enter the password. Make sure the passwords are identical.
        </div>

        <div tal:content="error">Validation error output</div>

        <input type="password"
                name="confirm"
                size="10"
                value=""
                tabindex=""
                tal:attributes="value confirm;
                                tabindex tabindex/next;"
                />
</div>

<div class="field"
    tal:define="error errors/email | nothing;
                email request/email | here/getEmailAddress;"
    tal:attributes="class python:test(error, 'field error', 'field')">

<label i18n:translate="label_email">E-mail</label>

<span class="fieldRequired" title="Required"
        i18n:attributes="title"
        i18n:translate="label_required">(Required)</span>

        <div class="formHelp" i18n:translate="help_email_creation">
        Enter an email address. This is necessary in case the password
        is lost. We respect your privacy, and will not give the address
        away to any third parties or expose it anywhere.
        </div>

        <div tal:content="error">Validation error output</div>

        <input type="text"
                name="email"
                size="30"
                tabindex=""
                tal:attributes="value email;
                                tabindex tabindex/next;"
                />
</div>


<div class="formControls">
<input class="context"
        type="submit"
        tabindex=""
        name="form.button.Submit"
        value="Submit"
        i18n:attributes="value"
        tal:attributes="tabindex tabindex/next;" />
</div>

</fieldset>

<input type="hidden" name="form.submitted" value="1" />

</form>

</div>

</body>

</html>
